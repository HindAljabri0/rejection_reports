<div class="advance-search">
    <mat-form-field class="search-mode-select">
        <mat-select [value]="selectedSearchMode" (selectionChange)="onSearchModeChange($event);">
            <mat-option *ngFor="let type of searchModes" [value]="type.key">
                {{type.label}}
            </mat-option>
        </mat-select>
    </mat-form-field>
    <div class="input-wrapper">
        <input type="text" [formControl]="searchControl" [matChipInputFor]="chipList" autocomplete="off" [readonly]="selectedSearchMode == 'payer&date'"
            (keyup.enter)="search(true)">
        <!-- <button mat-icon-button (click)="search()" class="search-btn">
            <mat-icon>search</mat-icon>
        </button> -->
        <div class="search-btns" *ngIf="isClaimUser && hasNphiesClaims && selectedCriteriaIsUsedInBoth else showOnlySearchIcon">
            <button type="button" matRipple matRippleColor="rgba(48,96,170,0.1)" class="search-btn" (click)="search(true)">
                <mat-icon>search</mat-icon>
                <span>Waseel</span>
            </button>
            <span class="separator"></span>
            <button type="button" matRipple matRippleColor="rgba(48,96,170,0.1)" class="search-btn" (click)="search(false)">
                <mat-icon>search</mat-icon>
                <span>NPHIES</span>
            </button>
        </div>

        <ng-template #showOnlySearchIcon>
            <div class="search-btns">
                <button type="button" matRipple matRippleColor="rgba(48,96,170,0.1)" class="search-btn" (click)="search(true)">
                    <mat-icon>search</mat-icon>
                    <span>Waseel</span>
                </button>
            </div>
        </ng-template>

        <mat-chip-list #chipList (keyup.enter)="search(true)">
            <ng-container *ngIf="selectedSearchMode == 'payer&date' || selectedSearchMode == 'tpa&date'">
                <mat-chip matTooltip="Select Payer" [matMenuTriggerFor]="payersMenu" *ngIf="selectedSearchMode == 'payer&date'">
                    <span [ngStyle]="{'color':payerHasError? '#D84646':'#3A3A3A'}">{{selectedPayer != null? selectedPayer.name : 'Select Payer'}}</span>
                </mat-chip>
                <mat-chip matTooltip="Select TPA" [matMenuTriggerFor]="tpasMenu" *ngIf="selectedSearchMode == 'tpa&date'">
                    <span [ngStyle]="{'color':tpaHasError? '#D84646':'#3A3A3A'}">{{selectedTpa != null? selectedTpa.name : 'Select TPA'}}</span>
                </mat-chip>
                <mat-chip matTooltip="From Date" (click)="fromPicker.open()">
                    <input [matDatepicker]="fromPicker" [formControl]="fromDateControl" class="hidden-input">
                    <span [ngStyle]="{'color':fromDateHasError? '#D84646':'#3A3A3A'}">{{dateToText(fromDateControl.value) || 'Select From Date'}}</span>
                    <mat-datepicker #fromPicker></mat-datepicker>
                </mat-chip>
                <mat-chip matTooltip="To Date" (click)="toPicker.open()">
                    <input [matDatepicker]="toPicker" [formControl]="toDateControl" class="hidden-input">
                    <span [ngStyle]="{'color':toDateHasError? '#D84646':'#3A3A3A'}">{{dateToText(toDateControl.value) || 'Select To Date'}}</span>
                    <mat-datepicker #toPicker></mat-datepicker>
                </mat-chip>
            </ng-container>
        </mat-chip-list>
    </div>
    <button class="icon-btn close-btn" (click)="toggleSearch()" mat-icon-button matTooltip="Close">
        <mat-icon aria-hidden="false" aria-label="Close">close</mat-icon>
    </button>
</div>

<mat-menu #payersMenu>
    <button *ngFor="let payer of payers" (click)="selectedPayer = payer" mat-menu-item>
        <span>{{payer.name}}</span>
    </button>
</mat-menu>

<mat-menu #tpasMenu>
    <button *ngFor="let tpa of tpas" (click)="selectedTpa = tpa" mat-menu-item>
        <span>{{tpa.name}}</span>
    </button>
</mat-menu>