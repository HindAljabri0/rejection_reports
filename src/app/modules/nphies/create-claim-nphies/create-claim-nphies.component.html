<!-- <div class="animate__animated animate__faster animate__fadeIn">
  <div *ngIf="errorMessage != null  && !isLoading" class="p-3 bg-white">
      <p class="error-card mb-0">{{errorMessage}}</p>
  </div> -->

<div class="animate__animated animate__faster animate__fadeIn">
  <mat-progress-bar *ngIf="isLoading && pageMode != 'CREATE'" mode="indeterminate" class="page-top-loader">
  </mat-progress-bar>

  <div>
    <form [formGroup]="FormNphiesClaim" (ngSubmit)="onSubmit()">
      <ng-container *ngIf="pageMode == 'CREATE' || pageMode == 'CREATE_FROM_RETRIEVED'; else statusHeader">
        <div class="block-header">
          <!-- <p>Create Claim</p> -->
        </div>
      </ng-container>
      <ng-template #statusHeader>
        <ng-container>
          <div class="block-header">
            <!-- <p>View Claim</p> -->

                <div
                  class="claim-status-header {{(pageMode == 'CREATE') ? '' : 'text-' +getClaimStatusColor(otherDataModel.status)}}">
                  <p class="title">View Claim</p>
                  <div class="summary">
                    <p><span>Provider Reference
                        No.:</span>&nbsp;<strong>{{otherDataModel.provClaimNo}}</strong>
                    </p>
                    <p *ngIf="otherDataModel.batchNumber!=null" ><span>Batch
                        Number:</span>&nbsp;<strong>{{otherDataModel.batchNumber}}</strong>
                    </p>
                    <p *ngIf="otherDataModel.submissionDate!=null"><span>Submission
                        Date:</span>&nbsp;<strong>{{otherDataModel.submissionDate}}</strong>
                    </p>
                    <!-- <p ><span>Payer Batch Reference
                        No.:</span>&nbsp;<strong>{{1}}</strong>
                    </p>
                    <p ><span>Payer Claim Reference
                        No.:</span>&nbsp;<strong>{{2}}</strong>
                    </p>
         -->
                    <p><span>Status:</span>&nbsp;<strong>{{otherDataModel.status}}</strong>
                    </p>
        
                    <!-- <p ><span>Status
                        Description:</span>&nbsp;<strong>{{1}}</strong>
                    </p> -->
                  </div>
                </div>
            
          </div>
          
        </ng-container>
        
      </ng-template>
  
      <!-- <ng-container
      *ngIf="pageMode == 'VIEW'">
      <claim-data [claimType]='claimType'></claim-data>
    </ng-container> -->
  
      <div class="block-body create-claim-body">
       
        <div class="bg-white">
          <mat-tab-group [dynamicHeight]="true" class="primary-tab">
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon class="mr-1" *ngIf="checkErrorClaimInfo === true"
                  [class.text-danger]="checkErrorClaimInfo === true">
                  error</mat-icon>
                <span [class.text-danger]="checkErrorClaimInfo === true">Claim Information</span>
              </ng-template>
              <h5 class="form-title pt-0">Beneficary Info</h5>
              <div *ngIf="pageMode !== 'VIEW'" class="d-flex">
                <div class="form-group flex-grow-1"
                  [ngClass]="{'has-error' : (isSubmitted || FormNphiesClaim.get('beneficiaryName').touched) && FormNphiesClaim.get('beneficiaryName').hasError('required')}">
                  <label class="control-label">Select a Beneficiary<span class="asterisk">*</span></label>
                  <input type="text" class="form-control" placeholder="Search for beneficiary by name or document ID..."
                    formControlName="beneficiaryName" [matAutocomplete]="auto" (keyup)="searchBeneficiaries()">
                  <mat-autocomplete #auto="matAutocomplete">
                    <mat-option *ngFor="let beneficiary of beneficiariesSearchResult"
                      (click)="selectBeneficiary(beneficiary)">
                      {{beneficiary.name}} ({{beneficiary.documentId}})
                    </mat-option>
                  </mat-autocomplete>
                  <div
                    *ngIf="(isSubmitted || FormNphiesClaim.get('beneficiaryName').touched) && FormNphiesClaim.get('beneficiaryName').hasError('required')">
                    <span class="error-text">Please select a Beneficiary</span>
                  </div>
                </div>
                <div [hidden]="pageMode === 'VIEW' || pageMode === 'EDIT'" class="form-group pl-3 pr-3">
                  <label class="control-label">&nbsp;</label>
                  <span class="pt-2 d-block semibold">OR</span>
                </div>
                <div [hidden]="pageMode === 'VIEW' || pageMode === 'EDIT'" class="form-group">
                  <label class="control-label">&nbsp;</label>
                  <button routerLink="/nphies/beneficiary" type="button" mat-flat-button class="text-nowrap"
                    color="primary">Create New Beneficiary</button>
                </div>
              </div>

              <div class="row" *ngIf="pageMode === 'VIEW' && otherDataModel && otherDataModel.beneficiary">
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Name</div>
                    <p class="form-control-static">{{otherDataModel.beneficiary.beneficiaryName}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Document</div>
                    <p class="form-control-static">{{otherDataModel.beneficiary.documentType}}
                      ({{otherDataModel.beneficiary.documentId}})</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Gender</div>
                    <p class="form-control-static">{{otherDataModel.beneficiary.gender}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Date of Birth</div>
                    <p class="form-control-static">{{otherDataModel.beneficiary.dob | date: 'dd-MM-yyyy'}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Contact No.</div>
                    <p class="form-control-static">{{otherDataModel.beneficiary.contactNumber}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Email</div>
                    <p class="form-control-static">{{otherDataModel.beneficiary.email ?
                      otherDataModel.beneficiary.email:"-"}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Insurance Plan</div>
                    <p class="form-control-static">{{otherDataModel.insurancePlan}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Pre Authorization Reference Numbers</div>
                    <p class="form-control-static">{{otherDataModel.preAuthRefNo ? otherDataModel.preAuthRefNo : "-"}}
                    </p>
                  </div>
                </div>
              </div>


              <div class="row" *ngIf="pageMode !== 'VIEW' && selectedBeneficiary && selectedBeneficiary.plans">
                <div class="col-md-4">
                  <div class="form-group" [matTooltip]="selectedPlanIdError"
                    [ngClass]="{'has-error' : (isSubmitted || FormNphiesClaim.get('insurancePlanId').touched) && FormNphiesClaim.get('insurancePlanId').hasError('required')}">
                    <label class="control-label">Insurance Plan<span class="asterisk">*</span></label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="insurancePlanId">
                        <mat-option value="">Select Insurance Plan</mat-option>
                        <mat-option *ngFor="let plan of selectedBeneficiary.plans" [value]="plan.payerNphiesId">
                          {{plan.primary? '(Primary) ':''}}Member ID: {{plan.memberCardId}}
                          ({{plan.payerName}}){{isPlanExpired(plan.expiryDate)}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                    <div
                      *ngIf="(isSubmitted || FormNphiesClaim.get('insurancePlanId').touched) && FormNphiesClaim.get('insurancePlanId').hasError('required')">
                      <span class="error-text">Please select an Insurance Plan</span>
                    </div>
                  </div>
                </div>
                <div class="col-4 col-lg-3">
                  <div class="form-group">
                    <label class="control-label">Preauthorization Reference No</label>
                    <!-- <input class="form-control" placeholder="Approval Response IDs" formControlName="preAuthResponseId"> -->
                    <tag-input formControlName="preAuthRefNo" [placeholder]="'Enter Response Id'">
                      <!-- <tag-input-dropdown [autocompleteItems]="['321654', '564654', '654654']">
                      </tag-input-dropdown> -->
                    </tag-input>
                  </div>
                </div>
              </div>

              <h5 class="form-title">Claim Info</h5>
              <div class="row small-gutter" *ngIf="pageMode !== 'VIEW'">
                <div class="col-4 col-xxl-3">
                  <div class="form-group"
                    [ngClass]="{'has-error' : (isSubmitted || FormNphiesClaim.get('dateOrdered').touched) && FormNphiesClaim.get('dateOrdered').hasError('required')}">
                    <label class="control-label">Date Ordered<span class="asterisk">*</span></label>
                    <div class="date-picker">
                      <input [matDatepicker]="dateOrderedCtrl" class="form-control" placeholder="Select date ordered"
                        [max]="today" formControlName="dateOrdered">
                      <mat-datepicker-toggle [for]="dateOrderedCtrl"></mat-datepicker-toggle>
                      <mat-datepicker #dateOrderedCtrl></mat-datepicker>
                    </div>
                    <div
                      *ngIf="(isSubmitted || FormNphiesClaim.get('dateOrdered').touched) && FormNphiesClaim.get('dateOrdered').hasError('required')">
                      <span class="error-text">Please enter Date Ordered</span>
                    </div>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group"
                    [ngClass]="{'has-error' : (isSubmitted || FormNphiesClaim.get('payeeType').touched) && FormNphiesClaim.get('payeeType').hasError('required')}">
                    <label class="control-label">Payee Type<span class="asterisk">*</span></label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="payeeType" (selectionChange)="onPayeeTypeChange()">
                        <mat-option value="">Select Payee Type</mat-option>
                        <mat-option *ngFor="let pType of payeeTypeList" [value]="pType">{{pType.name}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                    <div
                      *ngIf="(isSubmitted || FormNphiesClaim.get('payeeType').touched) && FormNphiesClaim.get('payeeType').hasError('required')">
                      <span class="error-text">Please select Payee Type</span>
                    </div>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group"
                    [ngClass]="{'has-error' : (isSubmitted || FormNphiesClaim.get('payee').touched) && FormNphiesClaim.get('payee').hasError('required')}">
                    <label class="control-label">Payee<span class="asterisk">*</span></label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="payee">
                        <mat-option value="">Select Payee</mat-option>
                        <mat-option *ngFor="let payee of payeeList" [value]="payee.nphiesId">{{payee.englistName}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                    <div
                      *ngIf="(isSubmitted || FormNphiesClaim.get('payee').touched) && FormNphiesClaim.get('payee').hasError('required')">
                      <span class="error-text">Please select payee</span>
                    </div>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group"
                    [ngClass]="{'has-error' : (isSubmitted || FormNphiesClaim.get('type').touched) && FormNphiesClaim.get('type').hasError('required')}">
                    <label class="control-label">Type<span class="asterisk">*</span></label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="type" (selectionChange)="onTypeChange($event)">
                        <mat-option value="">Select Type</mat-option>
                        <mat-option *ngFor="let type of typeList" [value]="type">{{type.name}}</mat-option>
                      </mat-select>
                    </mat-form-field>
                    <div
                      *ngIf="(isSubmitted || FormNphiesClaim.get('type').touched) && FormNphiesClaim.get('type').hasError('required')">
                      <span class="error-text">Please select a Type</span>
                    </div>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">Sub Type</label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="subType">
                        <mat-option value="">Select Sub Type</mat-option>
                        <mat-option *ngFor="let sub of subTypeList" [value]="sub">{{sub.name}}</mat-option>
                        <!-- <mat-option *ngIf="FormNphiesClaim.controls.type.value === 'institutional'" value="ip">
                          InPatient
                        </mat-option>
                        <mat-option *ngIf="FormNphiesClaim.controls.type.value === 'professional' ||
                      FormNphiesClaim.controls.type.value === 'oral' ||
                      FormNphiesClaim.controls.type.value === 'vision' ||
                      FormNphiesClaim.controls.type.value === 'pharmacy'" value="op">OutPatient</mat-option>
                        <mat-option *ngIf="FormNphiesClaim.controls.type.value === 'institutional'" value="emr">
                          Emergency
                        </mat-option> -->
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
                <div class="col-4 col-lg-3">
                  <div class="form-group">
                    <label class="control-label">Offline Eligibility ID</label>
                    <input class="form-control" placeholder="Enter Offline Eligibility ID"
                      formControlName="eligibilityOfflineId">
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">Offline Eligibility Date</label>
                    <div class="date-picker">
                      <input [matDatepicker]="eligibilityOfflineDateCtrl" class="form-control"
                        placeholder="Select Offline Eligibility Date" [max]="today"
                        formControlName="eligibilityOfflineDate">
                      <mat-datepicker-toggle [for]="eligibilityOfflineDateCtrl"></mat-datepicker-toggle>
                      <mat-datepicker #eligibilityOfflineDateCtrl></mat-datepicker>
                    </div>
                  </div>
                </div>
                <div class="col-4 col-lg-3">
                  <div class="form-group">
                    <label class="control-label">Eligibility Response ID</label>
                    <input class="form-control" placeholder="Eligibility Response ID"
                      formControlName="eligibilityResponseId">
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">Offline Approval Date</label>
                    <div class="date-picker">
                      <input [matDatepicker]="offlineApprovalDateCtrl" class="form-control"
                        placeholder="Select Offline Approval Date" [max]="today" formControlName="preAuthOfflineDate">
                      <mat-datepicker-toggle [for]="offlineApprovalDateCtrl"></mat-datepicker-toggle>
                      <mat-datepicker #offlineApprovalDateCtrl></mat-datepicker>
                    </div>
                  </div>
                </div>
                <div class="col-4 col-lg-3">
                  <div class="form-group">
                    <label class="control-label">Approval Response ID</label>
                    <input class="form-control" placeholder="Approval Response IDs" formControlName="preAuthResponseId">
                  </div>
                </div>
              </div>

              <div *ngIf="pageMode === 'VIEW' && otherDataModel && otherDataModel.payeeName" class="row">
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Date Ordered</div>
                    <p class="form-control-static">{{FormNphiesClaim.controls.dateOrdered.value | date: 'dd-MM-yyyy'}}
                    </p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Payee Type</div>
                    <p class="form-control-static">{{FormNphiesClaim.controls.payeeType.value.name}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Payee</div>
                    <p class="form-control-static">{{otherDataModel.payeeName}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Type</div>
                    <p class="form-control-static">{{FormNphiesClaim.controls.type.value.name}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Sub Type</div>
                    <p class="form-control-static">{{FormNphiesClaim.controls.subType.value ?
                      FormNphiesClaim.controls.subType.value.name : "-"}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Offline Eligibility ID</div>
                    <p class="form-control-static">{{FormNphiesClaim.controls.eligibilityOfflineId.value ?
                      FormNphiesClaim.controls.eligibilityOfflineId.value : "-"}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Offline Eligibility Date</div>
                    <p class="form-control-static">{{FormNphiesClaim.controls.eligibilityOfflineDate.value ?
                      (FormNphiesClaim.controls.eligibilityOfflineDate.value | date:
                      'dd-MM-yyyy') : "-"}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Eligibility Response ID</div>
                    <p class="form-control-static">{{FormNphiesClaim.controls.eligibilityResponseId.value ?
                      FormNphiesClaim.controls.eligibilityResponseId.value : "-"}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Offline Approval Date</div>
                    <p class="form-control-static">{{FormNphiesClaim.controls.preAuthOfflineDate.value ?
                      (FormNphiesClaim.controls.preAuthOfflineDate.value | date:
                      'dd-MM-yyyy') : "-"}}</p>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group form-group-static">
                    <div class="control-label">Approval Response IDs</div>
                    <p class="form-control-static">{{FormNphiesClaim.controls.preAuthResponseId.value ?
                      FormNphiesClaim.controls.preAuthResponseId.value : "-"}}</p>
                  </div>
                </div>
              </div>

            </mat-tab>
            <mat-tab [label]="'Care Team'">
              <ng-template mat-tab-label>
                <mat-icon class="mr-1" *ngIf="IsCareTeamRequired" [class.text-danger]="IsCareTeamRequired">
                  error</mat-icon>
                <span [class.text-danger]="IsCareTeamRequired">Care Team</span>
              </ng-template>
              <h5 class="form-title pt-0">
                <span [ngClass]="{'text-danger': IsCareTeamRequired}">Care Team<span class="asterisk" *ngIf="pageMode != 'VIEW'">*</span></span>
                <button [hidden]="pageMode === 'VIEW'" type="button" class="btn-icon btn-primary ml-auto"
                  (click)="openAddEditCareTeam()">
                  <mat-icon>add</mat-icon>
                </button>
              </h5>
              <div *ngIf="CareTeams.length > 0" class="table-responsive">
                <table class="primary-grid no-borders">
                  <thead>
                    <tr>
                      <th>Practitioner</th>
                      <th>Practitioner Role</th>
                      <th>Care Team Role</th>
                      <th>Qualification</th>
                      <th [hidden]="pageMode === 'VIEW'" width="10"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let careTeam of CareTeams; let i = index">
                      <td>
                        {{careTeam.practitionerName}}
                      </td>
                      <td>
                        {{careTeam.practitionerRoleName}}
                      </td>
                      <td>
                        {{careTeam.careTeamRoleName}}
                      </td>
                      <td>
                        {{careTeam.speciality}}
                      </td>
                      <td [hidden]="pageMode === 'VIEW'" class="actions">
                        <button mat-icon-button type="button" matTooltip="Edit" (click)="openAddEditCareTeam(careTeam)"
                          class="text-primary">
                          <mat-icon>create</mat-icon>
                        </button>
                        <button mat-icon-button type="button" matTooltip="Delete"
                          (click)="deleteCareTeam(careTeam.sequence, i)" class="text-primary m-0">
                          <mat-icon>delete_outline</mat-icon>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <app-empty-state *ngIf="!IsCareTeamRequired && CareTeams.length === 0" message='No Care Team found!'>
              </app-empty-state>
              <app-empty-state [ngClass]="{'text-danger': IsCareTeamRequired}"
                *ngIf="IsCareTeamRequired && CareTeams.length === 0" message='Care Team required!'>
              </app-empty-state>
            </mat-tab>
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon class="mr-1" *ngIf="IsDiagnosisRequired" [class.text-danger]="IsDiagnosisRequired">
                  error</mat-icon>
                <span [class.text-danger]="IsDiagnosisRequired">Diagnosis</span>
              </ng-template>
              <h5 class="form-title pt-0">
                <span [ngClass]="{'text-danger': IsDiagnosisRequired}">Diagnosis<span class="asterisk" *ngIf="pageMode != 'VIEW'">*</span></span>
                <button [hidden]="pageMode === 'VIEW'" type="button" class="btn-icon btn-primary ml-auto"
                  (click)="openAddEditDiagnosis()" [disabled]="!FormNphiesClaim.controls.type.value">
                  <mat-icon>add</mat-icon>
                </button>
              </h5>
              <div *ngIf="Diagnosises.length > 0" class="table-responsive">
                <table class="primary-grid no-borders">
                  <thead>
                    <tr>
                      <th>Code - Description</th>
                      <th>Type</th>
                      <th>On Admission</th>
                      <th [hidden]="pageMode === 'VIEW'" width="10"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let diagnosis of Diagnosises; let i = index">
                      <td>
                        {{diagnosis.diagnosisCode}} - {{diagnosis.diagnosisDescription}}
                      </td>
                      <td>
                        {{diagnosis.typeName}}
                      </td>
                      <td>
                        {{diagnosis.onAdmissionName ? diagnosis.onAdmissionName :"-"}}
                      </td>
                      <td [hidden]="pageMode === 'VIEW'" class="actions">
                        <button type="button" mat-icon-button matTooltip="Edit"
                          (click)="openAddEditDiagnosis(diagnosis)" class="text-primary">
                          <mat-icon>create</mat-icon>
                        </button>
                        <button mat-icon-button type="button" matTooltip="Delete" class="text-primary m-0"
                          (click)="deleteDiagnosis(diagnosis.sequence, i)">
                          <mat-icon>delete_outline</mat-icon>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <app-empty-state *ngIf="!IsDiagnosisRequired && Diagnosises.length === 0" message='No Diagnosis found!'>
              </app-empty-state>
              <app-empty-state [ngClass]="{'text-danger': IsDiagnosisRequired}"
                *ngIf="IsDiagnosisRequired && Diagnosises.length === 0" message='Diagnosis required!'>
              </app-empty-state>
            </mat-tab>
            <mat-tab
              *ngIf="FormNphiesClaim.controls.type.value && FormNphiesClaim.controls.type.value.value === 'vision'">
              <ng-template mat-tab-label>
                <mat-icon class="mr-1" *ngIf="checkErrorVision === true"
                  [class.text-danger]="checkErrorVision === true">
                  error</mat-icon>
                <span [class.text-danger]="checkErrorVision === true">Vision Prescription</span>
              </ng-template>
              <h5 class="form-title pt-0">
                Vision Prescription
              </h5>
              <div class="row small-gutter">
                <div class="col-4 col-xxl-3">
                  <div class="form-group"
                    [ngClass]="{'has-error' : IsDateWrittenRequired && ((isSubmitted || FormNphiesClaim.get('dateWritten').touched) && FormNphiesClaim.get('dateWritten').hasError('required'))}">
                    <label class="control-label">Date Written <span *ngIf="IsDateWrittenRequired"
                        class="asterisk">*</span></label>
                    <div class="date-picker">
                      <input [matDatepicker]="visionWrittenDate" class="form-control" placeholder="Select date written"
                        formControlName="dateWritten">
                      <mat-datepicker-toggle [for]="visionWrittenDate"></mat-datepicker-toggle>
                      <mat-datepicker #visionWrittenDate></mat-datepicker>
                    </div>
                    <div
                      *ngIf="IsDateWrittenRequired && ((isSubmitted || FormNphiesClaim.get('dateWritten').touched) && FormNphiesClaim.get('dateWritten').hasError('required'))">
                      <span class="error-text">Please select Date Written</span>
                    </div>
                  </div>
                </div>
                <div class="col-8 col-xxl-3">
                  <div class="form-group"
                    [ngClass]="{'has-error' : IsPrescriberRequired && ((isSubmitted || FormNphiesClaim.get('prescriber').touched) && FormNphiesClaim.get('prescriber').hasError('required'))}">
                    <label class="control-label">Prescriber<span *ngIf="IsPrescriberRequired"
                        class="asterisk">*</span></label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="prescriber">
                        <mat-option value="">Select Prescriber</mat-option>
                        <mat-option *ngFor="let pre of CareTeams" [value]="pre.sequence">{{pre.physicianCode}} -
                          {{pre.practitionerName}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                    <div
                      *ngIf="IsPrescriberRequired && ((isSubmitted || FormNphiesClaim.get('prescriber').touched) && FormNphiesClaim.get('prescriber').hasError('required'))">
                      <span class="error-text">Please select a Prescriber</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="box">
                <h5 class="d-flex align-items-center mb-3">
                  <strong [ngClass]="{'text-danger': IsLensSpecificationRequired}" class="medium">Lens
                    Specifications</strong>
                  <button [hidden]="pageMode === 'VIEW'" type="button" (click)="openAddEditVisionLensDialog()"
                    class="btn-icon btn-primary ml-auto">
                    <mat-icon>add</mat-icon>
                  </button>
                </h5>
                <div *ngIf="VisionSpecifications" class="table-responsive">
                  <table class="primary-grid manual-row-color no-borders">
                    <thead>
                      <tr>
                        <th>Product</th>
                        <th>Eye</th>
                        <th>Sphere</th>
                        <th>Cylinder</th>
                        <th>Axis</th>
                        <th>Add</th>
                        <th>Power</th>
                        <th>Back Curve</th>
                        <th>Diameter</th>
                        <th>Prism</th>
                        <th [hidden]="pageMode === 'VIEW'" width="10"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let visionSpecification of VisionSpecifications; let i = index">
                        <td>{{visionSpecification.productName}}</td>
                        <td>{{visionSpecification.eye | titlecase}} <span *ngIf="visionSpecification.eye">Eye</span>
                        </td>
                        <td>{{visionSpecification.sphere}}</td>
                        <td>{{visionSpecification.cylinder}}</td>
                        <td>{{visionSpecification.axis}}</td>
                        <td>{{visionSpecification.multifocalPower}}</td>
                        <td>{{visionSpecification.lensPower}}</td>
                        <td>{{visionSpecification.lensBackCurve}}</td>
                        <td>{{visionSpecification.lensDiameter}}</td>
                        <td>{{visionSpecification.prismAmount}}<span
                            *ngIf="visionSpecification.prismAmount">/</span>{{visionSpecification.prismBaseName}}</td>
                        <td [hidden]="pageMode === 'VIEW'" class="actions">
                          <button mat-icon-button type="button"
                            (click)="openAddEditVisionLensDialog(visionSpecification)" matTooltip="Edit"
                            class="text-primary">
                            <mat-icon>create</mat-icon>
                          </button>
                          <button mat-icon-button type="button" (click)="deleteVisionLens(i)" matTooltip="Delete"
                            class="text-primary">
                            <mat-icon>delete_outline</mat-icon>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <app-empty-state *ngIf="!IsLensSpecificationRequired && VisionSpecifications.length === 0"
                  message='No Lens Specifications found!'>
                </app-empty-state>
                <app-empty-state [ngClass]="{'text-danger': IsLensSpecificationRequired}"
                  *ngIf="IsLensSpecificationRequired && VisionSpecifications.length === 0"
                  message='Lens Specifications reqired!'>
                </app-empty-state>
              </div>
            </mat-tab>
            <mat-tab [label]="'Supporting Info'">
              <h5 class="form-title pt-0">
                <span>Supporting Info</span>
                <button [hidden]="pageMode === 'VIEW'" type="button" class="btn-icon btn-primary ml-auto"
                  (click)="openAddEditSupportInfoDialog()">
                  <mat-icon>add</mat-icon>
                </button>
              </h5>
              <div *ngIf="SupportingInfo.length > 0" class="table-responsive">
                <table class="primary-grid no-borders">
                  <thead>
                    <tr>
                      <th>Category</th>
                      <th>Code</th>
                      <th>Timing</th>
                      <th>Value</th>
                      <th>Reason</th>
                      <th [hidden]="pageMode === 'VIEW'" width="10"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let s of SupportingInfo; let i = index">
                      <td>
                        {{s.categoryName}}
                      </td>
                      <td>
                        {{s.code ? s.code :"-"}} <span *ngIf="s.codeName">- {{s.codeName}}</span>
                        <!-- {{s.codeName}} -->
                      </td>
                      <td>
                        <span *ngIf="!s.fromDateStr && !s.toDateStr">-</span>
                        <span *ngIf="!s.toDate">{{s.fromDateStr}}</span>
                        <span *ngIf="s.toDate">{{s.fromDateStr}} - {{s.toDateStr}}</span>
                      </td>
                      <td>
                        {{s.value ? s.value:"-"}} <span *ngIf="s.unit">{{s.unit}}</span>
                      </td>
                      <td>
                        {{s.reasonName ? s.reasonName:"-"}}
                      </td>
                      <td [hidden]="pageMode === 'VIEW'" class="actions">
                        <button mat-icon-button type="button" matTooltip="Edit" class="text-primary"
                          (click)="openAddEditSupportInfoDialog(s)">
                          <mat-icon>create</mat-icon>
                        </button>
                        <button mat-icon-button type="button" matTooltip="Delete" class="text-primary m-0"
                          (click)="deleteSupportingInfo(s.sequence, i)">
                          <mat-icon>delete_outline</mat-icon>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <app-empty-state *ngIf="SupportingInfo.length === 0" message='No Supporting Info found!'>
              </app-empty-state>
            </mat-tab>
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon class="mr-1" *ngIf="checkErrorAccident === true"
                  [class.text-danger]="checkErrorAccident === true">
                  error</mat-icon>
                <span [class.text-danger]="checkErrorAccident === true">Accident</span>
              </ng-template>
              <div *ngIf="pageMode !== 'VIEW'" class="row small-gutter">
                <div class="col-4 col-xxl-3">
                  <div class="form-group"
                    [ngClass]="{'has-error' : IsAccidentTypeRequired && ((isSubmitted || FormNphiesClaim.get('accidentType').touched) && FormNphiesClaim.get('accidentType').hasError('required'))}">
                    <label class="control-label">Accident Type<span *ngIf="IsAccidentTypeRequired"
                        class="asterisk">*</span></label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="accidentType">
                        <mat-option value="">Select Accident Type</mat-option>
                        <mat-option *ngFor="let type of accidentTypeList" [value]="type">{{type.name}}</mat-option>
                      </mat-select>
                    </mat-form-field>
                    <div
                      *ngIf="IsAccidentTypeRequired && ((isSubmitted || FormNphiesClaim.get('accidentType').touched) && FormNphiesClaim.get('accidentType').hasError('required'))">
                      <span class="error-text">Please select an Accident Type</span>
                    </div>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">Street Name</label>
                    <input placeholder="Enter street name" class="form-control" formControlName="streetName">
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">City</label>
                    <input placeholder="Enter city" class="form-control" formControlName="city">
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">State/Province</label>
                    <input placeholder="Enter state/province" class="form-control" formControlName="state">
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">Country</label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select [value]="selectedCountry" formControlName="country"
                        (selectionChange)="selectedCountry = $event.value;" #Country>
                        <mat-option>
                          <ngx-mat-select-search placeholderLabel="Select Country"
                            noEntriesFoundLabel="No nationalities found" formControlName="countryName"
                            name='selectedCountry'>
                          </ngx-mat-select-search>
                        </mat-option>
                        <mat-option value="">Select Country</mat-option>
                        <mat-option *ngFor="let nationality of filteredNations | async " [value]="nationality.Name">
                          {{nationality.Name}}</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group"
                    [ngClass]="{'has-error' : IsDateRequired && ((isSubmitted || FormNphiesClaim.get('date').touched) && FormNphiesClaim.get('date').hasError('required'))}">
                    <label class="control-label">Date<span *ngIf="IsDateRequired" class="asterisk">*</span></label>
                    <div class="date-picker">
                      <input [matDatepicker]="accidentDate" class="form-control" placeholder="Select date"
                        formControlName="date">
                      <mat-datepicker-toggle [for]="accidentDate"></mat-datepicker-toggle>
                      <mat-datepicker #accidentDate></mat-datepicker>
                    </div>
                    <div
                      *ngIf="IsDateRequired && ((isSubmitted || FormNphiesClaim.get('date').touched) && FormNphiesClaim.get('date').hasError('required'))">
                      <span class="error-text">Please enter date</span>
                    </div>
                  </div>
                </div>
              </div>
              <app-empty-state *ngIf="pageMode === 'VIEW' && (!this.otherDataModel || !this.otherDataModel.accident)" message='No Accident found!'>
              </app-empty-state>
              <div *ngIf="pageMode === 'VIEW' && this.otherDataModel && this.otherDataModel.accident" class="row">
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Accident Type</label>
                    <p class="form-control-static">{{this.otherDataModel && this.otherDataModel.accident ?
                      FormNphiesClaim.controls.accidentType.value.name : "-"}}</p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Street Name</label>
                    <p class="form-control-static">{{this.otherDataModel && this.otherDataModel.accident ?
                      FormNphiesClaim.controls.streetName.value : "-"}}</p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">City</label>
                    <p class="form-control-static">{{this.otherDataModel && this.otherDataModel.accident ?
                      FormNphiesClaim.controls.city.value : "-"}}</p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">State/Province</label>
                    <p class="form-control-static">{{this.otherDataModel && this.otherDataModel.accident ?
                      FormNphiesClaim.controls.state.value : "-"}}</p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Country</label>
                    <p class="form-control-static">{{this.otherDataModel && this.otherDataModel.accident ?
                      FormNphiesClaim.controls.country.value : "-"}}</p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Date</label>
                    <p class="form-control-static">{{this.otherDataModel && this.otherDataModel.accident ?
                      (FormNphiesClaim.controls.startDate.value | date: 'dd-MM-yyyy') : ""}} - {{this.otherDataModel
                      &&
                      this.otherDataModel.accident ?
                      (FormNphiesClaim.controls.periodEnd.value | date: 'dd-MM-yyyy') : ""}}</p>
                  </div>
                </div>
              </div>

            </mat-tab>
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon class="mr-1" *ngIf="IsItemRequired" [class.text-danger]="IsItemRequired">
                  error</mat-icon>
                <span [class.text-danger]="IsItemRequired">Items</span>
              </ng-template>
              <h5 class="form-title pt-0">
                <span [ngClass]="{'text-danger': IsItemRequired}">Items<span class="asterisk" *ngIf="pageMode != 'VIEW'">*</span></span>
                <button [hidden]="pageMode === 'VIEW'" type="button" (click)="openAddEditItemDialog()"
                  class="btn-icon btn-primary ml-auto"
                  [disabled]="!FormNphiesClaim.controls.type.value || (FormNphiesClaim.controls.type.value && FormNphiesClaim.controls.type.value.value !== 'pharmacy' && CareTeams.length === 0)">
                  <mat-icon>add</mat-icon>
                </button>
              </h5>

              <div *ngIf="Items.length > 0" class="table-responsive">
                <table class="primary-grid manual-row-color claim-view-table no-borders">
                  <thead>
                    <tr>
                      <th width="10"></th>
                      <th>Type</th>
                      <th>Code - Description</th>
                      <th>Quantity</th>
                      <th>Unit Price</th>
                      <th>Net</th>
                      <th>Non Standard Code</th>
                      <th [hidden]="pageMode === 'VIEW'" width="10"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <ng-container *ngFor="let item of Items; let i = index">
                      <tr>
                        <td class="text-primary text-center row-click" width="10"
                          (click)="currentOpenItem = (i == currentOpenItem) ? -1 : i">
                          <mat-icon *ngIf="currentOpenItem!=i" class="size-21">add_circle_outline</mat-icon>
                          <mat-icon *ngIf="currentOpenItem==i" class="size-21">remove_circle_outline</mat-icon>
                        </td>
                        <td class="row-click" (click)="currentOpenItem = (i == currentOpenItem) ? -1 : i">
                          {{item.typeName}}</td>
                        <td class="row-click" (click)="currentOpenItem = (i == currentOpenItem) ? -1 : i">
                          {{item.itemCode}} - {{item.itemDescription}}</td>
                        <td class="row-click" (click)="currentOpenItem = (i == currentOpenItem) ? -1 : i">
                          {{item.quantity}}</td>
                        <td class="text-nowrap row-click" (click)="currentOpenItem = (i == currentOpenItem) ? -1 : i">
                          {{item.unitPrice}} <span class="currency">SR</span></td>
                        <td class="text-nowrap row-click" (click)="currentOpenItem = (i == currentOpenItem) ? -1 : i">
                          {{item.net}} <span class="currency">SR</span></td>
                        <td class="row-click" (click)="currentOpenItem = (i == currentOpenItem) ? -1 : i">
                          {{item.nonStandardCode ? item.nonStandardCode:"-"}}</td>
                        <td [hidden]="pageMode === 'VIEW'" class="actions text-nowrap">
                          <button *ngIf="item.isPackage === 1" mat-icon-button type="button" matTooltip="Add Details"
                            class="text-primary" (click)="openAddEditItemDetailsDialog(item.sequence)">
                            <mat-icon>add</mat-icon>
                          </button>
                          <button mat-icon-button type="button" matTooltip="Edit" class="text-primary"
                            (click)="openAddEditItemDialog(item)">
                            <mat-icon>create</mat-icon>
                          </button>
                          <button mat-icon-button type="button" matTooltip="Delete" class="text-primary"
                            (click)="deleteItem(i)">
                            <mat-icon>delete_outline</mat-icon>
                          </button>
                        </td>
                      </tr>
                      <tr *ngIf="currentOpenItem==i">
                        <td colspan="9">
                          <div class="box mb-2">
                            <h5 class="align-self-center medium pb-2">Item Info</h5>
                            <div class="row">
                              <div class="col-4">
                                <table class="inline-label-table">
                                  <tbody>
                                    <tr>
                                      <td class="label">Quantity</td>
                                      <td>{{item.quantity}}</td>
                                    </tr>
                                    <tr>
                                      <td class="label">Discount(%)</td>
                                      <td>{{item.discount!=null?item.discount +" %":"-"}}</td>
                                    </tr>
                                    <tr>
                                      <td class="label">Tax(%)</td>
                                      <td>{{item.taxPercent!=null?item.taxPercent +" %":"-"}}</td>
                                    </tr>
                                    <tr>
                                      <td class="label">Patient Share</td>
                                      <td>{{item.patientShare!=null?item.patientShare +" %":"-"}}</td>
                                    </tr>
                                    <tr>
                                      <td class="label">Is Package?</td>
                                      <td>
                                        <span *ngIf="item.isPackage != 1 && item.isPackage !=2">-</span>
                                        <span *ngIf="item.isPackage === 1">Yes</span>
                                        <span *ngIf="item.isPackage === 2">No</span>
                                      </td>
                                    </tr>
                                    <tr>
                                      <td class="label">Body Site</td>
                                      <td>{{item.bodySiteName ? item.bodySiteName : "-"}}</td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                              <div class="col-4">
                                <table class="inline-label-table">
                                  <tbody>
                                    <tr>
                                      <td class="label">Unit Price</td>
                                      <td>{{item.unitPrice}} <span class="currency">SR</span></td>
                                    </tr>
                                    <tr>
                                      <td class="label">Factor</td>
                                      <td>{{item.factor}}</td>
                                    </tr>
                                    <tr>
                                      <td class="label">Tax</td>
                                      <td>{{item.tax !=null?item.tax:"-"}} <span class="currency" *ngIf="item.tax !=null">SR</span></td>
                                    </tr>
                                    <tr>
                                      <td class="label">Patient Share</td>
                                      <td>{{item.patientShare  !=null?item.patientShare:"-"}} <span class="currency" *ngIf="item.patientShare!=null">SR</span></td>
                                    </tr>
                                    <tr>
                                      <td class="label">Payer Share</td>
                                      <td>{{item.payerShare!=null?item.payerShare:"-"}} <span class="currency" *ngIf="item.payerShare!=null">SR</span></td>
                                    </tr>
                                    <tr>
                                      <td class="label">Sub Site</td>
                                      <td>{{item.subSiteName ? item.subSiteName :"-"}}</td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                              <div class="col-4">
                                <table class="inline-label-table">
                                  <tbody>
                                    <tr>
                                      <td class="label">Start Date</td>
                                      <td>{{item.startDateStr}}</td>
                                    </tr>
                                    <tr>
                                      <td class="label">Non Standard Code</td>
                                      <td>{{item.nonStandardCode ? item.nonStandardCode :"-"}}</td>
                                    </tr>
                                    <tr>
                                      <td class="label">Display</td>
                                      <td>{{item.display ? item.display :"-"}}</td>
                                    </tr>
                                    <tr>
                                      <td class="label">Supporting Info</td>
                                      <td>{{item.supportingInfoNames ? item.supportingInfoNames:"-"}}</td>
                                    </tr>
                                    <tr>
                                      <td class="label">Diagnosis</td>
                                      <td>{{item.diagnosisNames?item.diagnosisNames:"-"}}</td>
                                    </tr>
                                    <tr>
                                      <td class="label">Care Teams</td>
                                      <td>{{item.careTeamNames ? item.careTeamNames:"-"}}</td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>

                          <div class="box" *ngIf="item.itemDetails && item.itemDetails.length > 0">
                            <h5 class="align-self-center medium pb-2">Item Detail</h5>
                            <table class="primary-grid manual-row-color claim-view-table no-borders">
                              <thead>
                                <tr>
                                  <th>Seq.</th>
                                  <th>Type</th>
                                  <th>Code - Description</th>
                                  <th>Non Standard Code</th>
                                  <th>Display</th>
                                  <th [hidden]="pageMode === 'VIEW'" width="10"></th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr *ngFor="let d of item.itemDetails; let di = index">
                                  <td class="row-click">{{d.sequence}}</td>
                                  <td class="row-click">{{d.typeName}}</td>
                                  <td class="row-click">{{d.itemCode}} - {{d.itemDescription}}</td>
                                  <td class="row-click">{{d.nonStandardCode ? d.nonStandardCode :"-"}}</td>
                                  <td class="row-click">{{d.display ? d.display :"-"}}</td>
                                  <td [hidden]="pageMode === 'VIEW'" class="actions text-nowrap">
                                    <button mat-icon-button type="button" matTooltip="Edit" class="text-primary"
                                      (click)="openAddEditItemDetailsDialog(item.sequence, d)">
                                      <mat-icon>create</mat-icon>
                                    </button>
                                    <button mat-icon-button type="button" matTooltip="Delete" class="text-primary"
                                      (click)="deleteItemDetails(item.sequence, di)">
                                      <mat-icon>delete_outline</mat-icon>
                                    </button>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </td>
                      </tr>
                    </ng-container>
                  </tbody>
                </table>
              </div>
              <div [ngClass]="{'text-danger': IsItemRequired}">
                <app-empty-state *ngIf="!IsItemRequired && Items.length === 0" message='No Item found!'>
                </app-empty-state>
                <app-empty-state *ngIf="IsItemRequired && Items.length === 0" message='Item required!'>
                </app-empty-state>
              </div>


            </mat-tab>
            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon class="mr-1" *ngIf="checkErrorEncounter === true"
                  [class.text-danger]="checkErrorEncounter === true">
                  error</mat-icon>
                <span [class.text-danger]="checkErrorEncounter === true">Encounter</span>
              </ng-template>
              <div class="row small-gutter" *ngIf="pageMode !== 'VIEW'">
                <div class="col-4 col-xxl-3">
                  <div class="form-group"
                    [ngClass]="{'has-error' : IsStatusRequired && ((isSubmitted || FormNphiesClaim.get('status').touched) && FormNphiesClaim.get('status').hasError('required'))}">
                    <label class="control-label">Status<span *ngIf="IsStatusRequired" class="asterisk">*</span></label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="status" (selectionChange)="onStatusOrClassChange()">
                        <mat-option value="">Select status</mat-option>
                        <mat-option *ngFor="let status of encounterStatusList" [value]="status.value">{{status.name}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                    <div
                      *ngIf="IsStatusRequired && ((isSubmitted || FormNphiesClaim.get('status').touched) && FormNphiesClaim.get('status').hasError('required'))">
                      <span class="error-text">Please select status</span>
                    </div>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group"
                    [ngClass]="{'has-error' : IsClassRequired && ((isSubmitted || FormNphiesClaim.get('encounterClass').touched) && FormNphiesClaim.get('encounterClass').hasError('required'))}">
                    <label class="control-label">Class<span *ngIf="IsClassRequired" class="asterisk">*</span></label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="encounterClass" (selectionChange)="onStatusOrClassChange()">
                        <mat-option value="">Select class</mat-option>
                        <mat-option *ngFor="let class of encounterClassList" [value]="class.value">{{class.name}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                    <div
                      *ngIf="IsClassRequired && ((isSubmitted || FormNphiesClaim.get('encounterClass').touched) && FormNphiesClaim.get('encounterClass').hasError('required'))">
                      <span class="error-text">Please select Class</span>
                    </div>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">Service Type</label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="serviceType">
                        <mat-option value="">Select service type</mat-option>
                        <mat-option *ngFor="let serviceType of encounterServiceTypeList" [value]="serviceType.value">
                          {{serviceType.name}}</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group"
                    [ngClass]="{'has-error' : IsServiceProviderRequired && ((isSubmitted || FormNphiesClaim.get('serviceProvider').touched) && FormNphiesClaim.get('serviceProvider').hasError('required'))}">
                    <label class="control-label">Service Provider<span *ngIf="IsServiceProviderRequired"
                        class="asterisk">*</span></label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="serviceProvider">
                        <mat-option value="">Select service provider</mat-option>
                        <mat-option *ngFor="let payee of payeeList" [value]="payee.nphiesId">{{payee.englistName}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div
                    *ngIf="IsServiceProviderRequired && ((isSubmitted || FormNphiesClaim.get('serviceProvider').touched) && FormNphiesClaim.get('serviceProvider').hasError('required'))">
                    <span class="error-text">Please select Service Provider</span>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">Priority</label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="priority">
                        <mat-option value="">Select priority</mat-option>
                        <mat-option *ngFor="let priority of encounterPriorityList" [value]="priority.value">
                          {{priority.name}}</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">Period</label>
                    <div class="row small-gutter">
                      <div class="col-6">
                        <div class="date-picker">
                          <input [matDatepicker]="periodStartDate" class="form-control" placeholder="Start date"
                            formControlName="startDate">
                          <mat-datepicker-toggle [for]="periodStartDate"></mat-datepicker-toggle>
                          <mat-datepicker #periodStartDate></mat-datepicker>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="date-picker">
                          <input [matDatepicker]="periodEndDate" class="form-control" placeholder="End date"
                            formControlName="periodEnd">
                          <mat-datepicker-toggle [for]="periodEndDate"></mat-datepicker-toggle>
                          <mat-datepicker #periodEndDate></mat-datepicker>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <app-empty-state *ngIf="pageMode === 'VIEW' && !otherDataModel.claimEncounter " message='No Encounter found!'>
              </app-empty-state>
              <div class="row" *ngIf="pageMode === 'VIEW' && otherDataModel.claimEncounter">
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Status</label>
                    <p class="form-control-static">{{otherDataModel.claimEncounter &&
                      otherDataModel.claimEncounter.statusName ? otherDataModel.claimEncounter.statusName : "-"}}</p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Class</label>
                    <p class="form-control-static">{{otherDataModel.claimEncounter &&
                      otherDataModel.claimEncounter.encounterClassName ?
                      otherDataModel.claimEncounter.encounterClassName:"-"}}</p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Service Type</label>
                    <p class="form-control-static">{{otherDataModel.claimEncounter &&
                      otherDataModel.claimEncounter.serviceTypeName ?
                      otherDataModel.claimEncounter.serviceTypeName:"-"}}</p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Service Provider</label>
                    <p class="form-control-static">{{otherDataModel.claimEncounter &&
                      otherDataModel.claimEncounter.serviceProviderName ?
                      otherDataModel.claimEncounter.serviceProviderName:"-"}}</p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Priority</label>
                    <p class="form-control-static">{{otherDataModel.claimEncounter &&
                      otherDataModel.claimEncounter.priorityName ? otherDataModel.claimEncounter.priorityName:"-"}}
                    </p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Period</label>
                    <p class="form-control-static">{{otherDataModel.claimEncounter &&
                      otherDataModel.claimEncounter.startDate ? (otherDataModel.claimEncounter.startDate | date:
                      'dd-MM-yyyy') : ""}} - {{otherDataModel.claimEncounter &&
                      otherDataModel.claimEncounter.periodEnd
                      ? (otherDataModel.claimEncounter.periodEnd | date:'dd-MM-yyyy') :""}}</p>
                  </div>
                </div>
              </div>

              <h5 class="form-title" *ngIf="(pageMode !== 'VIEW')||(pageMode === 'VIEW' && otherDataModel.claimEncounter) ">Hospitalization</h5>
              <div class="row small-gutter" *ngIf="pageMode !== 'VIEW'">
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">Origin</label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="origin">
                        <mat-option value="">Select provider</mat-option>
                        <mat-option *ngFor="let payee of payeeList" [value]="payee.nphiesId">{{payee.englistName}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">Admin Source</label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="adminSource">
                        <mat-option value="">Select admin source</mat-option>
                        <mat-option *ngFor="let adminSource of encounterAdminSourceList" [value]="adminSource.value">
                          {{adminSource.name}}</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">Readmission</label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="reAdmission">
                        <mat-option value="">Select readmission</mat-option>
                        <mat-option *ngFor="let reAdmission of encounterReAdmissionList" [value]="reAdmission.value">
                          {{reAdmission.name}}</mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group">
                    <label class="control-label">Discharge Disposition</label>
                    <mat-form-field class="form-control custom-select-control">
                      <mat-select formControlName="dischargeDispotion">
                        <mat-option value="">Select discharge disposition</mat-option>
                        <mat-option *ngFor="let dd of encounterDischargeDispositionList" [value]="dd.value">
                          {{dd.name}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>

              </div>

              <div class="row" *ngIf="pageMode === 'VIEW' && otherDataModel.claimEncounter">
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Origin</label>
                    <p class="form-control-static">{{otherDataModel.claimEncounter &&
                      otherDataModel.claimEncounter.originName ? otherDataModel.claimEncounter.originName:"-"}}</p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Admin Source</label>
                    <p class="form-control-static">{{otherDataModel.claimEncounter &&
                      otherDataModel.claimEncounter.adminSourceName ?
                      otherDataModel.claimEncounter.adminSourceName:"-"}}</p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Readmission</label>
                    <p class="form-control-static">{{otherDataModel.claimEncounter &&
                      otherDataModel.claimEncounter.reAdmissionName ?
                      otherDataModel.claimEncounter.reAdmissionName:"-"}}</p>
                  </div>
                </div>
                <div class="col-4 col-xxl-3">
                  <div class="form-group form-group-static">
                    <label class="control-label">Discharge Disposition</label>
                    <p class="form-control-static">{{otherDataModel.claimEncounter &&
                      otherDataModel.claimEncounter.dischargeDispotionName ?
                      otherDataModel.claimEncounter.dischargeDispotionName:"-"}}</p>
                  </div>
                </div>

              </div>

            </mat-tab>
            <mat-tab *ngIf="pageMode == 'VIEW' || pageMode == 'EDIT'">
              <ng-template mat-tab-label>
                <div class="d-flex align-items-center">
                  <span>Communication</span>
                </div>
              </ng-template>
              <div class="communication-wrapper">
                <h5 class="form-title px-14 py-0 mb-0">
                  <button type="button" mat-flat-button class="primary-text-btn ml-auto px-0" disableRipple="true"
                    (click)="openAddCommunicationDialog()">
                    <mat-icon>add_circle_outline</mat-icon>
                    <span class="pl-1">Add Communication</span>
                  </button>
                </h5>
                <ul class="communication">
                  <li *ngFor="let communication of communications">
                    <ng-container *ngIf="communication.communicationRequestId">
                      <div class="header-block">
                        <div class="message">
                          <div class="table-responsive pb-2">
                            <table cellspacing="0" cellpadding="0" border="0"
                              class="primary-grid manual-row-color horizontal-borders">
                              <tbody>
                                <ng-container *ngFor="let payload of communication.payloadList">
                                  <tr *ngIf="payload.payloadValue">
                                    <td class="px-0">{{payload.payloadValue}}</td>
                                  </tr>
                                  <tr
                                    *ngIf="payload.payloadAttachment && payload.attachmentType && getFilename(payload.attachmentType) === 'image'">
                                    <td class="px-0">
                                      <ul class="inline-attachments no-space">
                                        <li>
                                          <button type="button">
                                            <img src="./assets/file-types/ic-jpg.svg" alt="JPG" />
                                            <span>{{payload.attachmentName}}</span>
                                          </button>
                                        </li>
                                      </ul>
                                    </td>
                                  </tr>
                                  <tr
                                    *ngIf="payload.payloadAttachment && payload.attachmentType && getFilename(payload.attachmentType) === 'pdf'">
                                    <td class="px-0">
                                      <ul class="inline-attachments no-space">
                                        <li>
                                          <button type="button">
                                            <img src="./assets/file-types/ic-pdf.svg" alt="PDF" />
                                            <span>{{payload.attachmentName}}</span>
                                          </button>
                                        </li>
                                      </ul>
                                    </td>
                                  </tr>
                                </ng-container>
                              </tbody>
                            </table>
                          </div>
                          <span>Communication Request ID: {{communication.requestIdentifierId}} &nbsp;&nbsp;&nbsp;&nbsp;
                            Date: {{communication.communicationDate | date : 'dd/MM/yyyy hh:mm aa'}}</span>
                        </div>
                        <div class="ml-auto">
                          <button type="button" class="action-btn"
                            (click)="openAddCommunicationDialog(communication.communicationRequestId)">
                            <mat-icon class="text-primary">reply</mat-icon>
                            <span>Reply</span>
                          </button>
                        </div>
                      </div>
                      <ng-container *ngIf="communication.communicationDataList">
                        <div class="body-block sent" *ngFor="let reply of communication.communicationDataList">
                          <div class="message size-sm">
                            <div class="table-responsive pb-2">
                              <table cellspacing="0" cellpadding="0" border="0"
                                class="primary-grid manual-row-color horizontal-borders">
                                <tbody>
                                  <ng-container *ngFor="let payload of reply.payloadList">
                                    <tr *ngIf="payload.payloadValue">
                                      <td class="px-0">{{payload.payloadValue}}</td>
                                    </tr>
                                    <tr
                                      *ngIf="payload.payloadAttachment && payload.attachmentType && getFilename(payload.attachmentType) === 'image'">
                                      <td class="px-0">
                                        <ul class="inline-attachments no-space">
                                          <li>
                                            <button type="button">
                                              <img src="./assets/file-types/ic-jpg.svg" alt="JPG" />
                                              <span>{{payload.attachmentName}}</span>
                                            </button>
                                          </li>
                                        </ul>
                                      </td>
                                    </tr>
                                    <tr
                                      *ngIf="payload.payloadAttachment && payload.attachmentType && getFilename(payload.attachmentType) === 'pdf'">
                                      <td class="px-0">
                                        <ul class="inline-attachments no-space">
                                          <li>
                                            <button type="button">
                                              <img src="./assets/file-types/ic-pdf.svg" alt="PDF" />
                                              <span>{{payload.attachmentName}}</span>
                                            </button>
                                          </li>
                                        </ul>
                                      </td>
                                    </tr>
                                  </ng-container>
                                </tbody>
                              </table>
                            </div>
                            <span>Communication ID: {{reply.communicationResponseId}} &nbsp;&nbsp;&nbsp;&nbsp; Date:
                              {{reply.createdDate | date : 'dd/MM/yyyy hh:mm aa'}}</span>
                          </div>
                        </div>
                      </ng-container>

                    </ng-container>
                    <ng-container *ngIf="!communication.communicationRequestId">
                      <div class="header-block sent">
                        <div class="message">
                          <div class="table-responsive pb-2">
                            <table cellspacing="0" cellpadding="0" border="0"
                              class="primary-grid manual-row-color horizontal-borders">
                              <tbody>
                                <ng-container *ngFor="let payload of communication.payloadList">
                                  <tr *ngIf="payload.payloadValue">
                                    <td class="px-0">{{payload.payloadValue}}</td>
                                  </tr>
                                  <tr
                                    *ngIf="payload.payloadAttachment && payload.attachmentType && getFilename(payload.attachmentType) === 'image'">
                                    <td class="px-0">
                                      <ul class="inline-attachments no-space">
                                        <li>
                                          <button type="button">
                                            <img src="./assets/file-types/ic-jpg.svg" alt="JPG" />
                                            <span>{{payload.attachmentName}}</span>
                                          </button>
                                        </li>
                                      </ul>
                                    </td>
                                  </tr>
                                  <tr
                                    *ngIf="payload.payloadAttachment && payload.attachmentType && getFilename(payload.attachmentType) === 'pdf'">
                                    <td class="px-0">
                                      <ul class="inline-attachments no-space">
                                        <li>
                                          <button type="button">
                                            <img src="./assets/file-types/ic-pdf.svg" alt="PDF" />
                                            <span>{{payload.attachmentName}}</span>
                                          </button>
                                        </li>
                                      </ul>
                                    </td>
                                  </tr>
                                </ng-container>
                              </tbody>
                            </table>
                          </div>
                          <span>Communication ID: {{communication.communicationResponseId}} &nbsp;&nbsp;&nbsp;&nbsp;
                            Date: {{communication.communicationDate | date : 'dd/MM/yyyy hh:mm aa'}}</span>
                        </div>
                      </div>
                    </ng-container>
                  </li>
                </ul>
              </div>
            </mat-tab>
          </mat-tab-group>
        </div>

      </div>

      <div class="block-footer sticky-bottom">
        <!-- <div class="left-block custom-paginator"
        *ngIf="pageMode != 'CREATE' && pageMode != 'CREATE_FROM_RETRIEVED' && paginationControl != null && paginationControl.size > 0">
        <button matRipple (click)="goToFirstPage()" type="button" title="First Page"
          [disabled]="paginationControl.currentIndex==0">
          <img src="./assets/ic-page-first.svg" alt="First" />
        </button>
        <button matRipple (click)="goToPrePage()" type="button" title="Previous Page"
          [disabled]="paginationControl.currentIndex==0">
          <img src="./assets/ic-page-prev.svg" alt="Previous" />
        </button>
        <p class="page-info">
          {{(paginationControl.currentIndex+1)}}<small>/{{paginationControl.size}}</small>
        </p>
        <button matRipple (click)="goToNextPage()" type="button" title="Next Page"
          [disabled]="(paginationControl.currentIndex+1)==paginationControl.size">
          <img src="./assets/ic-page-next.svg" alt="Next" />
        </button>
        <button matRipple (click)="goToLastPage()" type="button" title="Last Page"
          [disabled]="(paginationControl.currentIndex+1)==paginationControl.size">
          <img src="./assets/ic-page-last.svg" alt="Last" />
        </button>
      </div> -->
        <div class="right-block btn-list" *ngIf="pageMode == 'CREATE'">
          <!-- <button *ngIf="claim != null" mat-flat-button (click)="cancel()">Cancel</button> -->
          <!-- <button *ngIf="claim != null" mat-flat-button color="primary" (click)="save()">Save</button> -->
          <button type="submit" mat-flat-button color="primary">Save</button>
        </div>
        <div class="right-block btn-list" *ngIf="pageMode == 'VIEW'">
          <!-- <button *ngIf="claim != null" mat-flat-button (click)="close()">Close</button>
          <button *ngIf="claim != null && editable" mat-flat-button color="primary" (click)="edit()">Edit</button> -->
          <button type="button" mat-flat-button (click)="close()">Close</button>
          <!-- <button mat-flat-button color="primary" (click)="edit()">Edit</button> -->
        </div>
        <!-- <div class="right-block btn-list" *ngIf="pageMode == 'EDIT'">
          <button *ngIf="claim != null && !isLoading" mat-flat-button (click)="cancel()">Cancel</button>
          <button *ngIf="claim != null && !isLoading" mat-flat-button color="primary" (click)="save()">Save</button>
        </div> -->
      </div>
    </form>
  </div>
</div>
