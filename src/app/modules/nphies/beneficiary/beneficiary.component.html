<div class="animate__animated animate__faster animate__fadeIn">
    <ng-container *ngIf="!addMode && !editMode && !viewMode">
        <div class="block-header has-border">
            <p>Beneficiary</p>
        </div>
        <div class="block-filter-panel has-border">
            <div class="form-group">
                <label class="control-label">Search Beneficiary</label>
                <input placeholder="Search by Name, National ID, Contact no., File ID, Member Card ID" class="form-control">
            </div>
        </div>
        <!-- <div class="p-14 bg-white">
            <app-empty-state message='Search Beneficiary' icon="ic-empty-search.svg">
            </app-empty-state>
        </div> -->
        <ng-scrollbar smoothScroll [shown]="'hover'" [compact]="true" [trackX]="true" class="bg-white">
            <div class="fixed-height">
                <table class="primary-grid sticky-header" cellpadding="0" cellspacing="0" border="0">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>National ID</th>
                            <th>Contact No.</th>
                            <th>File ID</th>
                            <th>Member Card ID</th>
                            <th width="10"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let Beneficiary of Beneficiaries" >
                            <td class="row-click" (click)="viewMode=true">{{Beneficiary.fullName}}</td>
                            <td class="row-click" (click)="viewMode=true">{{Beneficiary.documentId}}</td>
                            <td class="row-click" (click)="viewMode=true">{{Beneficiary.contractNumber}}</td>
                            <td class="row-click" (click)="viewMode=true">{{Beneficiary.fileId}}</td>
                            <td class="row-click" (click)="viewMode=true">{{Beneficiary.memberCardId}}</td>
                            <td class="actions">
                                <button mat-icon-button matTooltip="Edit" class="text-primary" (click)="editMode=true">
                                    <mat-icon>create</mat-icon>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </ng-scrollbar>
        <button mat-fab color="primary" class="page-fab" (click)="addMode=true">
            <mat-icon>add</mat-icon>
        </button>
    </ng-container>
    <ng-container *ngIf="addMode || editMode">
        <div class="block-header has-border">
            <p>Add/Edit Beneficiary</p>
        </div>
        <div class="block-filter-panel">
            <h5 class="form-title pt-0">Personal Information</h5>
            <div class="row small-gutter">
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">First Name</label>
                        <input placeholder="Enter first name" class="form-control" (change)=" isFullNameDisabled()" [formControl]="firstNameController" [(ngModel)]="fullName">
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Second Name</label>
                        <input placeholder="Enter second name" class="form-control" (change)=" isFullNameDisabled()" [formControl]="secondNameController">
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Third Name</label>
                        <input placeholder="Enter third name" class="form-control" (change)=" isFullNameDisabled()" [formControl]="thirdNameController">
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Family Name</label>
                        <input placeholder="Enter family name" class="form-control" (change)=" isFullNameDisabled()" [formControl]="familyNameController">
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group" [matTooltip]="errors.fullName" [class.has-error]="errors.fullName!=null&&errors.fullName.trim().length>0">
                        <label class="control-label">Full Name<span class="asterisk">*</span></label>
                        <input placeholder="Enter full name" class="form-control" (change)="onNameChanged()" [formControl]="fullNameController">
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Beneficiary File ID</label>
                        <input placeholder="Enter beneficiary file ID" class="form-control" [formControl]="beneficiaryFileIdController">
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group" [matTooltip]="errors.dob" [class.has-error]="errors.dob!=null&&errors.dob.trim().length>0">
                        <label class="control-label">Date of Birth<span class="asterisk">*</span></label>
                        <div class="date-picker">
                            <input [matDatepicker]="dateOfBirth" class="form-control" placeholder="Select date of birth" [formControl]="dobFormControl">
                            <mat-datepicker-toggle [for]="dateOfBirth"></mat-datepicker-toggle>
                            <mat-datepicker #dateOfBirth></mat-datepicker>
                        </div>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group" [matTooltip]="errors.gender" [class.has-error]="errors.gender!=null&&errors.gender.trim().length>0">
                        <label class="control-label">Gender<span class="asterisk">*</span></label>
                        <mat-form-field class="form-control custom-select-control">
                            <mat-select [value]="selectedGender" (selectionChange)="selectedGender = $event.value;">
                                <mat-option value="">Select Gender</mat-option>
                                <mat-option value="MALE">Male</mat-option>
                                <mat-option value="FEMALE">Female</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group" [matTooltip]="errors.documentType" [class.has-error]="errors.documentType!=null&&errors.documentType.trim().length>0">
                        <label class="control-label">Document Type<span class="asterisk">*</span></label>
                        <mat-form-field class="form-control custom-select-control">
                            <mat-select [value]="selectedDocumentType" (selectionChange)="selectedDocumentType = $event.value;">
                                <mat-option value="">Select Document Type</mat-option>
                                <mat-option value="RESIDENT_CARD">Resident Card</mat-option>
                                <mat-option value="PASSPORT">Passport</mat-option>
                                <mat-option value="GCC_ID">GCC ID</mat-option>
                                <mat-option value="NATIONAL_CARD_OR_BORDER_NUMBER">National Card or Border Number</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group" [matTooltip]="errors.documentId" [class.has-error]="errors.documentId!=null&&errors.documentId.trim().length>0">
                        <label class="control-label">Document ID<span class="asterisk">*</span></label>
                        <input placeholder="Enter document ID" class="form-control" [formControl]="documentIdFormControl">
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">E-Health ID</label>
                        <input placeholder="Enter E-Health ID" class="form-control" [formControl]="EHealthIdNameController">
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Nationality</label>
                        <mat-form-field class="form-control custom-select-control">
                            <mat-select [value]="selectedNationality" (selectionChange)="selectedNationality = $event.value;" #nationalitySelect>
                                <mat-option>
                                    <ngx-mat-select-search placeholderLabel="Search Nationality" noEntriesFoundLabel="No nationalities found" [formControl]="nationalityFilterCtrl"
                                        name='searchedNationality'></ngx-mat-select-search>
                                </mat-option>
                                <mat-option value="">Select Nationality</mat-option>
                                <mat-option *ngFor="let nationality of filteredNations | async" [value]="nationality.Code">
                                    {{nationality.Name}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Residency Type</label>
                        <mat-form-field class="form-control custom-select-control">
                            <mat-select [value]="selectedResidencyType" (selectionChange)="selectedResidencyType = $event.value;" #ResidencyType>
                                <mat-option value="">Select Residency Type</mat-option>
                                <mat-option value="VISITOR">Visitor</mat-option>
                                <mat-option value="DEPENDENT">Dependent</mat-option>
                                <mat-option value="CITIZEN_OR_RESIDENT">Citizen or Resident</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Contact Number</label>
                        <input placeholder="Enter contact number" class="form-control" [formControl]="contactNumberController">
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Marital Status</label>
                        <mat-form-field class="form-control custom-select-control">
                            <mat-select [value]="selectedMaritalStatus" (selectionChange)="selectedMaritalStatus = $event.value;" required #maritalStatusSelect>

                                <mat-option value="">Select Marital Status</mat-option>
                                <mat-option *ngFor="let MaritalStatusValue of allMaritalStatuses | async" [value]="MaritalStatusValue.Code">
                                    {{MaritalStatusValue.Name}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Blood Group</label>
                        <mat-form-field class="form-control custom-select-control">
                            <mat-select [value]="selectedBloodGroup" (selectionChange)="selectedBloodGroup = $event.value;" #BloodGroupe>
                                <mat-option value="">Select Blood Group</mat-option>
                                <mat-option value="O_PLUS">O+</mat-option>
                                <mat-option value="O_MINUS">O-</mat-option>
                                <mat-option value="A_PLUS">A+</mat-option>
                                <mat-option value="A_MINUS">A-</mat-option>
                                <mat-option value="B_PLUS">B+</mat-option>
                                <mat-option value="B_MINUS">B-</mat-option>
                                <mat-option value="AB_PLUS">AB+</mat-option>
                                <mat-option value="AB_MINUS">AB-</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Preferred Language</label>
                        <mat-form-field class="form-control custom-select-control">
                            <mat-select [value]="selectedLanguages" (selectionChange)="selectedLanguages = $event.value;" #Language>
                                <mat-option value="">Select Preferred Language</mat-option>
                                <mat-option value="EN">English</mat-option>
                                <mat-option value="AR">Arabic</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Emergency Phone Number</label>
                        <input placeholder="Enter emergency phone number" class="form-control" [formControl]="emergencyPhoneNumberController">
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Email</label>
                        <input placeholder="Enter email" class="form-control" [formControl]="emailController">
                    </div>
                </div>
            </div>

            <h5 class="form-title">
                <span>Address</span>
                <button type="button" (click)="addAddress()" class="btn-icon btn-primary ml-auto">
                    <mat-icon>add</mat-icon>
                </button>
            </h5>
            <app-empty-state [className]="'mb-2'" *ngIf="addresses.length==0" [message]="'No addresses found!'"></app-empty-state>
            <div class="table-responsive" *ngIf="addresses.length>0">
                <table class="primary-grid manual-row-color claim-view-table no-borders">
                    <thead>
                        <tr>
                            <th>House No./Appartment</th>
                            <th>Street Name</th>
                            <th>City</th>
                            <th>State/Province</th>
                            <th>Country</th>
                            <th>Postal Code</th>
                            <th width="10"></th>
                        </tr>
                    </thead>
                    <tbody>

                        <tr class="align-middle" *ngFor="let address  of addresses ; let i = index">
                            <td>
                                <input type="text" class="form-control minw145" placeholder="Enter House No./Appartment" [formControl]="address.houseNumberController" />
                            </td>
                            <td>
                                <input type="text" class="form-control minw145" placeholder="Enter Street Name" [formControl]="address.streetNameController" />
                            </td>
                            <td>
                                <input type="text" class="form-control minw145" placeholder="Enter City" [formControl]="address.cityNameController" />
                            </td>
                            <td>

                                <input type="text" class="form-control minw145" placeholder="Enter State/Province" [formControl]="address.stateController" />

                            </td>
                            <td>
                                <mat-form-field class="form-control custom-select-control">
                                    <mat-select [value]="address.selectedCountry" (selectionChange)="address.selectedCountry = $event.value;" #Country>
                                        <mat-option>
                                            <ngx-mat-select-search placeholderLabel="Select Country" noEntriesFoundLabel="No nationalities found"
                                                [formControl]="nationalityFilterCtrl" name='address.selectedCountry'></ngx-mat-select-search>
                                        </mat-option>
                                        <mat-option value="">Select Country</mat-option>
                                        <mat-option *ngFor="let nationality of filteredNations | async" [value]="nationality.Code">
                                            {{nationality.Name}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </td>
                            <td>
                                <input type="text" class="form-control minw145" placeholder="Enter Postal Code" [formControl]="address.postalCodeController" />
                            </td>
                            <td class="actions">
                                <button mat-icon-button matTooltip="Delete" class="text-primary m-0" (click)="deleteAddress(i)">
                                    <mat-icon>delete_outline</mat-icon>
                                </button>
                            </td>
                        </tr>

                    </tbody>
                </table>
            </div>


            <h5 class="form-title">
                <span>Insurance Plans</span>
                <button type="button" (click)="addInsurancePlan()" class="btn-icon btn-primary ml-auto">
                    <mat-icon>add</mat-icon>
                </button>
            </h5>
            <app-empty-state [className]="'mb-2'" *ngIf="insurancePlans.length==0" [message]="'No insurance plans found!'"></app-empty-state>
            <div class="table-responsive" *ngIf="insurancePlans.length>0">
                <mat-radio-group aria-label="Select an option" [(ngModel)]="setPrimary">
                    <table class="primary-grid manual-row-color claim-view-table no-borders">
                        <thead>
                            <tr>
                                <th class="text-center">Set Primary?</th>
                                <th>Payer<span class="asterisk">*</span></th>
                                <th>Expiry Date</th>
                                <th>Member Card ID<span class="asterisk">*</span></th>
                                <th width="10"></th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr class="align-middle" *ngFor="let insurancePlan  of insurancePlans , let i = index">
                                <td class="text-center">
                                    <mat-radio-button color="primary" class="grid-radio" [value]="i" [checked]="i+''==setPrimary"></mat-radio-button>
                                </td>
                                <td>
                                    <div class="form-group m-0" [matTooltip]="insurancePlan.payerErorr"
                                        [class.has-error]="insurancePlan.payerErorr!=null&&insurancePlan.payerErorr.trim().length>0">
                                        <mat-form-field class="form-control custom-select-control">
                                            <mat-select [value]="insurancePlan.selectePayer" (selectionChange)="insurancePlan.selectePayer = $event.value;">

                                                <mat-option value="">Select Payer</mat-option>
                                                <mat-option *ngFor="let payer of payersList" [value]="payer.payerId">{{payer.englistName}}({{payer.arabicName}})</mat-option>

                                            </mat-select>
                                        </mat-form-field>
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group m-0">
                                        <div class="date-picker">
                                            <input [matDatepicker]="expiryDate" class="form-control" placeholder="Select expiry date"
                                                [formControl]="insurancePlan.expiryDateController">
                                            <mat-datepicker-toggle [for]="expiryDate"></mat-datepicker-toggle>
                                            <mat-datepicker #expiryDate></mat-datepicker>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="form-group m-0" [matTooltip]="insurancePlan.memberCardIdErorr"
                                        [class.has-error]="insurancePlan.memberCardIdErorr!=null&&insurancePlan.memberCardIdErorr.trim().length>0">
                                        <input type="text" class="form-control" placeholder="Enter member card ID" [formControl]="insurancePlan.memberCardId" />
                                    </div>
                                </td>
                                <td class="actions">
                                    <button mat-icon-button matTooltip="Delete" class="text-primary m-0" (click)="deleteInsurancePlan(i)">
                                        <mat-icon>delete_outline</mat-icon>
                                    </button>
                                </td>
                            </tr>

                        </tbody>

                    </table>
                </mat-radio-group>
            </div>
            <hr class="hr spaced">
            <div class="form-group btn-list">
                <button type="button" mat-flat-button color="primary" *ngIf="addMode" (click)="save()">Add Beneficiary</button>
                <button type="button" mat-flat-button color="primary" *ngIf="editMode" (click)="editMode=false">Save</button>
                <button type="button" mat-flat-button (click)="addMode=false;editMode=false">Cancel</button>
            </div>
        </div>
    </ng-container>


    <ng-container *ngIf="viewMode">
        <div class="block-header has-border">
            <div class="d-flex align-items-center">
                <div class="actions mr-2 my-n2 ml-n1">
                    <button matRipple type="button" (click)="viewMode=false" class="action-btn">
                        <mat-icon>arrow_back</mat-icon>
                    </button>
                </div>
                <p>Lawrence Garcia</p>
            </div>
        </div>
        <div class="block-filter-panel">
            <h5 class="semibold pb-2 mb-3 border-bottom">Personal Information</h5>
            <div class="row small-gutter">
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">First Name</label>
                        <span class="form-control-static">First Name</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Second Name</label>
                        <span class="form-control-static">Second Name</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Third Name</label>
                        <span class="form-control-static">Third Name</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Family Name</label>
                        <span class="form-control-static">Family Name</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Full Name</label>
                        <span class="form-control-static">Full Name</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Beneficiary File ID</label>
                        <span class="form-control-static">Beneficiary File ID</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Date of Birth</label>
                        <span class="form-control-static">Date of Birth</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">E-Health ID</label>
                        <span class="form-control-static">E-Health ID</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Natiionality</label>
                        <span class="form-control-static">Natiionality</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Residency Type</label>
                        <span class="form-control-static">Residency Type</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Document Type</label>
                        <span class="form-control-static">Document Type</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Document ID</label>
                        <span class="form-control-static">Document ID</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Contact Number</label>
                        <span class="form-control-static">Contact Number</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Marital Status</label>
                        <span class="form-control-static">Marital Status</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Gender</label>
                        <span class="form-control-static">Gender</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Blood Group</label>
                        <span class="form-control-static">Blood Group</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Preferred Language</label>
                        <span class="form-control-static">Preferred Language</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Emergency Phone Number</label>
                        <span class="form-control-static">Emergency Phone Number</span>
                    </div>
                </div>
                <div class="col-4 col-lg-3">
                    <div class="form-group">
                        <label class="control-label">Email</label>
                        <span class="form-control-static">Email</span>
                    </div>
                </div>
            </div>

            <h5 class="form-title">Address</h5>
            <div class="table-responsive">
                <table class="primary-grid manual-row-color claim-view-table no-borders">
                    <thead>
                        <tr>
                            <th>House No./Appartment</th>
                            <th>Street Name</th>
                            <th>City</th>
                            <th>State/Province</th>
                            <th>Country</th>
                            <th>Postal Code</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>House No./Appartment</td>
                            <td>Street Name</td>
                            <td>City</td>
                            <td>State/Province</td>
                            <td>Country</td>
                            <td>Postal Code</td>
                        </tr>
                    </tbody>
                </table>
            </div>


            <h5 class="form-title">Insurance Plans</h5>
            <div class="table-responsive">
                <table class="primary-grid manual-row-color claim-view-table no-borders">
                    <thead>
                        <tr>
                            <th class="text-center text-nowrap" width="10">Set Primary?</th>
                            <th>Payer</th>
                            <th>Expiry Date</th>
                            <th>Member Card ID</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="text-center align-middle">
                                <mat-icon class="text-primary">done</mat-icon>
                            </td>
                            <td>Payer</td>
                            <td>Expiry Date</td>
                            <td>Member Card ID</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <hr class="hr spaced">
            <div class="form-group">
                <button type="button" mat-flat-button color="primary" (click)="viewMode=false">Back to Search</button>
            </div>
        </div>
    </ng-container>
</div>