<div class="animate__animated animate__faster animate__fadeIn tawuniya-report-details">
    <div class="block-header has-border align-items-center">
        <div class="left-block">
            <ul class="custom-breadcrumb">
                <li><a routerLink="/reports/creditReports" class="primary-link">Credit Reports</a></li>
                <li class="active">Tawuniya</li>
            </ul>
        </div>
        <div class="right-block"
            *ngIf="data != null && (data.providercreditReportInformation.status=='INVALID' || data.providercreditReportInformation.status=='FAILED') &&  data.providercreditReportInformation != null">
            <button type="button" class="error-btn" (click)="openErrorsDialog()" matRipple>
                <mat-icon>error</mat-icon>
                <span>View Errors</span>
            </button>
        </div>
    </div>
    <div class="credit-report-header">
        <div class="left-block align-items-start">
            <div class="message">
                <mat-icon>info</mat-icon>
                <p>With reference to your Credit Request mentioned above and for a fair, full and final settlement,
                    please be advised of the following</p>
            </div>
        </div>
        <div class="right-block text-sm">
            <div class="row align-items-center">
                <div class="col">
                    <div *ngIf="data != null &&  data.providercreditReportInformation != null" class="row small-gutter">
                        <div class="col-xxl-1-5 col-xl-3 col-md-4">
                            <div class="inline-labelled-text">
                                <label>Received Date</label>
                                <p>{{data.providercreditReportInformation.reportdate}}</p>
                            </div>
                        </div>
                        <div class="col-xxl-1-5 col-xl-3 col-md-4">
                            <div class="inline-labelled-text">
                                <label>Batch Received Date</label>
                                <p>{{data.providercreditReportInformation.batchreceiveddate}}</p>
                            </div>
                        </div>
                        <div class="col-xxl-1-5 col-xl-3 col-md-4">
                            <div class="inline-labelled-text">
                                <label>Credit Report Status</label>
                                <p>{{data.providercreditReportInformation.status}}</p>
                            </div>
                        </div>
                        <div class="col-xxl-1-5 col-xl-3 col-md-4">
                            <div class="inline-labelled-text">
                                <label>Policy Name</label>
                                <p>{{data.providercreditReportInformation.policyno}}</p>
                            </div>
                        </div>
                        <div class="col-xxl-1-5 col-xl-3 col-md-4">
                            <div class="inline-labelled-text">
                                <label>Provider City</label>
                                <p>{{data.providercreditReportInformation.providercity}}</p>
                            </div>
                        </div>
                        <div class="col-xxl-1-5 col-xl-3 col-md-4">
                            <div class="inline-labelled-text">
                                <label>Batch Reference Number</label>
                                <p>{{data.providercreditReportInformation.batchreferenceno}}</p>
                            </div>
                        </div>
                        <div class="col-xxl-1-5 col-xl-3 col-md-4">
                            <div class="inline-labelled-text">
                                <label>Claim Month</label>
                                <p>{{data.providercreditReportInformation.lossmonth}}</p>
                            </div>
                        </div>
                        <div class="col-xxl-1-5 col-xl-3 col-md-4">
                            <div class="inline-labelled-text">
                                <label>Provider</label>
                                <p>{{data.providercreditReportInformation.providername}}</p>
                            </div>
                        </div>
                        <div class="col-xxl-1-5 col-xl-3 col-md-4">
                            <div class="inline-labelled-text">
                                <label>Plan Number</label>
                                <p>{{data.providercreditReportInformation.planno}}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="data != null &&  data.remainingDays != null" class="col-auto">
                    <h4 class="text-primary semibold">{{data.remainingDays}} Days</h4>
                </div>
            </div>
        </div>
    </div>
    <div class="tawuniya-details-subheader">
        <div *ngIf="data != null &&  data.providercreditReportInformation != null" class="row">
            <div class="col-lg-3 col-4">
                <div class="inline-labelled-text horizontal secondary">
                    <label>Requested Amount (Net)</label>
                    <p>{{data.providercreditReportInformation.requestedamount | currency:' '}} SR</p>
                </div>
            </div>
            <div class="col-lg-3 col-4">
                <div class="inline-labelled-text horizontal secondary">
                    <label>Difference In Deductible</label>
                    <p>{{data.providercreditReportInformation.differenceindeductibles | currency:' '}} SR</p>
                </div>
            </div>
            <div class="col-lg-3 col-4">
                <div class="inline-labelled-text horizontal secondary">
                    <label>Rejected Claims Amount</label>
                    <p>{{data.providercreditReportInformation.rejectedclaimsamount | currency:' '}} SR</p>
                </div>
            </div>
            <div class="col-lg-3 col-4">
                <div class="inline-labelled-text horizontal secondary">
                    <label>Net Deducted Services</label>
                    <p>{{data.providercreditReportInformation.netdeductedservices | currency:' '}} SR</p>
                </div>
            </div>
            <div class="col-lg-3 col-4">
                <div class="inline-labelled-text horizontal secondary">
                    <label>Difference In Discounts</label>
                    <p>{{data.providercreditReportInformation.differenceindeductibles | currency:' '}} SR</p>
                </div>
            </div>
            <div class="col-lg-3 col-4">
                <div class="inline-labelled-text horizontal secondary">
                    <label>Transferred Batch Amount</label>
                    <p>{{data.providercreditReportInformation.transferredbatchamount | currency:' '}} SR</p>
                </div>
            </div>
            <div class="col-lg-3 col-4">
                <div class="inline-labelled-text horizontal secondary">
                    <label>Bills Not Recieved</label>
                    <p>{{data.providercreditReportInformation.billsnotreceived | currency:' '}} SR</p>
                </div>
            </div>
            <div class="col-lg-3 col-4">
                <div class="inline-labelled-text horizontal secondary">
                    <label>Total Payable</label>
                    <p>{{data.providercreditReportInformation.totalamountpayable | currency:' '}} SR</p>
                </div>
            </div>
        </div>
    </div>
    <div class="bg-white">
        <div class="tawuniya-tab-action-wrapper">
            <div class="tawuniya-tab-action">
                <!-- <a href="#" class="primary-link underlined" title="Upload Attachments">Upload Attachments</a>
                <mat-menu #filterMenu="matMenu" class="primary-menu tawuniya-filter-menu" xPosition="before">
                    <label class="menu-title">Filter By</label>
                    <button mat-menu-item>Rejection Reason</button>
                    <button mat-menu-item>Agree</button>
                    <button mat-menu-item>Disagree</button>
                    <button mat-menu-item>None</button>
                    <label class="menu-title">Sort By</label>
                    <button mat-menu-item>Received Date</button>
                    <button mat-menu-item>Claim Month</button>
                </mat-menu>
                <a href="#" class="primary-link underlined" [matMenuTriggerFor]="filterMenu" (click)="$event.preventDefault();" title="Filter & Sort">Filter & Sort</a> -->
                <a *ngIf="(selectedServiceTab == 'deducted-services' && selectionControl.deducted.selections.length > 1) || (selectedServiceTab == 'rejected-services' && selectionControl.rejected.selections.length > 0)"
                    href="#" (click)="$event.preventDefault()" class="primary-link underlined" title="Agree" (click)="agreeOnSelectedServices()">Agree</a>
                <a *ngIf="(selectedServiceTab == 'deducted-services' && selectionControl.deducted.selections.length <= 1) || (selectedServiceTab == 'rejected-services' && selectionControl.rejected.selections.length == 0)"
                    href="#" (click)="$event.preventDefault()" class="primary-link underlined disabled">Agree</a>
                <mat-menu #disagreeMenu="matMenu" class="primary-menu tawuniya-edit-menu" xPosition="before">
                    <div (click)="$event.stopPropagation()">
                        <div class="form-group">
                            <label>Comment</label>
                            <textarea rows="4" class="form-control" [(ngModel)]="disagreeComment"></textarea>
                        </div>
                        <div class="text-right">
                            <button type="button" mat-flat-button color="primary" (click)="disagreeOnSelectedServices()">Apply</button>
                        </div>
                    </div>
                </mat-menu>
                <a *ngIf="(selectedServiceTab == 'deducted-services' && selectionControl.deducted.selections.length > 1) || (selectedServiceTab == 'rejected-services' && selectionControl.rejected.selections.length > 0)"
                    href="#" (click)="$event.preventDefault()" class="primary-link underlined" [matMenuTriggerFor]="disagreeMenu" title="Disagree">Disagree</a>
                <a *ngIf="(selectedServiceTab == 'deducted-services' && selectionControl.deducted.selections.length <= 1) || (selectedServiceTab == 'rejected-services' && selectionControl.rejected.selections.length == 0)"
                    href="#" (click)="$event.preventDefault()" class="primary-link underlined disabled">Disagree</a>
            </div>
        </div>
        <mat-tab-group [dynamicHeight]="true" class="primary-tab no-body-padding" (selectedTabChange)="onTabChange($event)">
            <mat-tab [label]="'Deducted Services'">
                <div class="table-responsive">
                    <table cellpadding="0" cellspacing="0" border="0" class="primary-grid">
                        <thead>
                            <tr>
                                <th width="10">
                                    <mat-checkbox class="grid-checkbox" color="primary" [(checked)]="selectionControl.deducted.allCheckBoxIsChecked"
                                        [(indeterminate)]="selectionControl.deducted.allCheckBoxIsIndeterminate" (change)="selectAllInPage('deducted')">
                                    </mat-checkbox>
                                </th>
                                <th>Waseel Batch</th>
                                <th>Doctor Code</th>
                                <th>Claim No</th>
                                <th>Provider Ref.</th>
                                <th>Service Code</th>
                                <th>Service</th>
                                <th>Rejection Reason</th>
                                <th>Comment</th>
                                <th>Exceed Price</th>
                                <th>Deducted Amount</th>
                                <th>Agreed</th>
                                <th width="10"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <ng-container *ngIf="!(deductedServices == null || deductedServices.length == 0)">
                                <tr class="row-click" *ngFor="let service of deductedServices" (click)="openDetailsDialog($event, service.id.serialno, 'deducted')">
                                    <td (click)="$event.stopPropagation();">
                                        <mat-checkbox class="grid-checkbox" color="primary" [checked]="selectionControl.deducted.selections.includes(service.id.serialno)"
                                            (change)="selectService('deducted', service.id.serialno)">
                                        </mat-checkbox>
                                    </td>
                                    <td>{{service.waseelbatch}}</td>
                                    <td>{{service.physicianid}}</td>
                                    <td (click)="$event.stopPropagation();showClaim(service.payerclaimno)" class="primary-link underlined disabled ng-star-inserted" href="#"
                                        title="payerClaimNo">{{service.payerclaimno}}</td>
                                    <td></td>
                                    <td>{{service.servicecode}}</td>
                                    <td>{{service.servicedescription}}</td>
                                    <td>{{service.rejectionreason}}</td>
                                    <td>{{service.comments}}</td>
                                    <td>{{service.exceedprice | currency:' '}} SR</td>
                                    <td>{{service.deductedamount | currency:' '}} SR</td>
                                    <td class="text-center">
                                        <mat-icon *ngIf="service.agree != null" [ngClass]="{'text-danger':service.agree =='N', 'text-success': service.agree =='Y'}"
                                            class="size-21">
                                            {{service.agree =='N'? 'cancel':'check_circle'}}</mat-icon>
                                    </td>
                                    <td class="actions">
                                        <button type="button" mat-icon-button class="text-success" matTooltip="Agree">
                                            <mat-icon class="material-icons-outlined">check_circle</mat-icon>
                                        </button>
                                        <button type="button" mat-icon-button class="text-danger" matTooltip="Disagree">
                                            <mat-icon class="material-icons-outlined">cancel</mat-icon>
                                        </button>
                                        <button *ngIf="isEditableBatch()" type="button" [matMenuTriggerFor]="editMenu1" (click)="$event.stopPropagation()" mat-icon-button
                                            class="text-primary">
                                            <mat-icon>edit</mat-icon>
                                        </button>
                                        <mat-menu #editMenu1="matMenu" class="primary-menu tawuniya-edit-menu" xPosition="before">
                                            <div (click)="$event.stopPropagation()">
                                                <div class="form-group">
                                                    <label>Comments</label>
                                                    <textarea rows="4" class="form-control" [(ngModel)]="service.newComments"></textarea>
                                                </div>
                                                <div class="form-group mb-0">
                                                    <label>Attachments</label>
                                                    <p class="text-sm text-grey pb-1">Note: The allowed file types are GIF,
                                                        JPEG, JPG, PNG, TIFF, PDF<br />Maximum File Size = 5.0 MB
                                                    </p>
                                                    <ul class="attachment-list">
                                                        <li *ngIf="service.newAttachment != null" [matTooltip]="service.newAttachment.name"
                                                            (click)="serviceBeingAttachedFileTo = service; fileInput.click()">
                                                            <img [src]="getImageOfBlob(service)" [alt]="service.newAttachment.name" />
                                                        </li>
                                                        <li *ngIf="service.newAttachment == null" matTooltip="Add Attachments" class="add-block">
                                                            <div class="file-upload-wrapper text-primary">
                                                                <div class="content" (click)="serviceBeingAttachedFileTo = service; fileInput.click()">
                                                                    <mat-icon>add_circle</mat-icon>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="text-right">
                                                    <button type="button" (click)="disagreeOnService(service)" mat-flat-button color="primary">
                                                        Apply
                                                    </button>
                                                </div>
                                            </div>
                                        </mat-menu>
                                    </td>
                                </tr>
                            </ng-container>
                            <tr *ngIf="deductedServices == null || deductedServices.length == 0">
                                <td colspan="13" class="p-0">
                                    <app-empty-state class="claim-list-empty-state" message='No reports found!'>
                                    </app-empty-state>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </mat-tab>
            <mat-tab [label]="'Rejected Claims Services'">
                <div class="table-responsive">
                    <table cellpadding="0" cellspacing="0" border="0" class="primary-grid">
                        <thead>
                            <tr>
                                <th width="10">
                                    <mat-checkbox class="grid-checkbox" color="primary" [(checked)]="selectionControl.rejected.allCheckBoxIsChecked"
                                        [(indeterminate)]="selectionControl.rejected.allCheckBoxIsIndeterminate" (change)="selectAllInPage('rejected')">
                                    </mat-checkbox>
                                </th>
                                <th>Waseel Batch</th>
                                <th>Doctor Code</th>
                                <th>Claim No</th>
                                <th>Provider Ref.</th>
                                <th>Service Code</th>
                                <th>Service</th>
                                <th>Rejection Reason</th>
                                <th>Comment</th>
                                <th>Exceed Price</th>
                                <th>Deducted Amount</th>
                                <th>Agreed</th>
                                <th width="10"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="row-click" *ngFor="let service of rejectedServices" (click)="openDetailsDialog($event, service.id.serialno, 'rejected')">
                                <td (click)="$event.stopPropagation()">
                                    <mat-checkbox class="grid-checkbox" color="primary" [checked]="selectionControl.rejected.selections.includes(service.id.serialno)"
                                        (change)="selectService('rejected', service.id.serialno)">
                                    </mat-checkbox>
                                </td>
                                <td>{{service.waseelbatch}}</td>
                                <td>{{service.physicianid}}</td>
                                <td (click)="$event.stopPropagation();showClaim(service.payerclaimno)" class="primary-link underlined disabled ng-star-inserted" href="#"
                                    title="payerClaimNo">{{service.payerclaimno}}</td>
                                <td></td>
                                <td>{{service.servicecode}}</td>
                                <td>{{service.servicedescription}}</td>
                                <td>{{service.rejectionreason}}</td>
                                <td>{{service.comments}}</td>
                                <td>{{service.exceedprice | currency:' '}} SR</td>
                                <td>{{service.deductedamount | currency:' '}} SR</td>
                                <td>
                                    <mat-icon *ngIf="service.agree != null" [ngClass]="{'text-danger':service.agree =='N', 'text-success': service.agree =='Y'}">
                                        {{service.agree =='N'? 'cancel':'check_circle'}}</mat-icon>
                                </td>
                                <td class="actions">
                                    <button *ngIf="isEditableBatch()" type="button" (click)="$event.stopPropagation()" [matMenuTriggerFor]="editMenu1" mat-icon-button
                                        class="text-primary">
                                        <mat-icon>edit</mat-icon>
                                    </button>
                                    <mat-menu #editMenu1="matMenu" class="primary-menu tawuniya-edit-menu" xPosition="before">
                                        <div (click)="$event.stopPropagation()">
                                            <div class="form-group">
                                                <label>Comments</label>
                                                <textarea rows="4" class="form-control" [(ngModel)]="service.newComments"></textarea>
                                            </div>
                                            <div class="form-group mb-0">
                                                <label>Attachments</label>
                                                <p class="text-sm text-grey pb-1">Note: The allowed file types are GIF,
                                                    JPEG, JPG, PNG, TIFF, PDF<br />Maximum File Size = 5.0 MB
                                                </p>
                                                <ul class="attachment-list">
                                                    <li *ngIf="service.newAttachment != null" [matTooltip]="service.newAttachment.name"
                                                        (click)="serviceBeingAttachedFileTo = service; fileInput.click()">
                                                        <img [src]="getImageOfBlob(service)" [alt]="service.newAttachment.name" />
                                                    </li>
                                                    <li *ngIf="service.newAttachment == null" matTooltip="Add Attachments" class="add-block">
                                                        <div class="file-upload-wrapper text-primary">
                                                            <div class="content" (click)="serviceBeingAttachedFileTo = service; fileInput.click()">
                                                                <mat-icon>add_circle</mat-icon>
                                                            </div>
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="text-right">
                                                <button type="button" (click)="disagreeOnService(service)" mat-flat-button color="primary">
                                                    Apply
                                                </button>
                                            </div>
                                        </div>
                                    </mat-menu>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="13" class="p-0">
                                    <app-empty-state *ngIf="rejectedServices == null || rejectedServices.length == 0" class="claim-list-empty-state" message='No reports found!'>
                                    </app-empty-state>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </mat-tab>
        </mat-tab-group>
    </div>
    <div class="block-footer sticky-bottom">
        <div class="left-block custom-paginator">
            <button matRipple type="button" title="First Page" (click)="goToFirstPage()">
                <img src="./assets/ic-page-first.svg" alt="First" />
            </button>
            <button matRipple type="button" title="Previous Page" (click)="goToPrePage()">
                <img src="./assets/ic-page-prev.svg" alt="Previous" />
            </button>
            <p class="page-info">
                {{paginationControl[selectedServiceTab].currentPage+1}}<small>/{{paginationControl[selectedServiceTab].numberOfPages}}</small>
            </p>
            <button matRipple type="button" title="Next Page" (click)="goToNextPage()">
                <img src="./assets/ic-page-next.svg" alt="Next" />
            </button>
            <button matRipple type="button" title="Last Page" (click)="goToLastPage()">
                <img src="./assets/ic-page-last.svg" alt="Last" />
            </button>
        </div>

        <div class="btn-list right-block">
            <button type="button" *ngIf="isEditableBatch()" (click)="submit()" color="primary" mat-flat-button>Submit</button>
        </div>
    </div>
</div>
<input hidden type="file" #fileInput onclick="this.value = null" (change)="selectFile($event.target.files)"
    accept="image/png,image/jpeg,image/jpg,image/tiff,image/gif,application/pdf" />