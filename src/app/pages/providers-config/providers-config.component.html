<app-detailscard title="Providers Configuration"
    [bottomLeftActionText]=" (isLoading || componentLoading.serviceCode || componentLoading.portalUser)? '' : 'Reset'"
    [bottomRightActionText]=" (isLoading || componentLoading.serviceCode || componentLoading.portalUser)? '' : 'Save'"
    (bottomLeftAction)=" reset()" (bottomRightAction)="save()">
    <div class="selectProvider">
        <mat-form-field style="width: 98%; margin-top: 20px;" appearance="outline">
            <mat-label>Select Provider</mat-label>
            <input matInput [matAutocomplete]="auto" [formControl]="providerController" (input)="updateFilter()"
                [readonly]="isLoading" (keyup.enter)="selectProvider()">
            <button mat-button matSuffix mat-icon-button>
                <mat-icon>arrow_drop_down</mat-icon>
            </button>
            <mat-autocomplete autoActiveFirstOption #auto>
                <mat-option *ngFor="let provider of filteredProviders"
                    [value]="provider.switchAccountId + ' | ' + provider.code + ' | ' + provider.name"
                    (click)="selectProvider(provider.switchAccountId)">
                    {{provider.switchAccountId}} | {{provider.code}} | {{provider.name}}
                </mat-option>
                <mat-option *ngIf="errors.providersError != null && errors.providersError != '' && !isLoading">
                    {{errors.providersError}}
                </mat-option>
            </mat-autocomplete>
        </mat-form-field>
    </div>

    <mat-accordion *ngIf="selectedProvider != null && selectedProvider != ''" multi="true">

        <mat-expansion-panel expanded="false">
            <mat-expansion-panel-header style="background-color: #fbfbfb;">
                <mat-panel-title style="color: #3060AA;">
                    MidTables Configuration
                </mat-panel-title>
                <mat-panel-description *ngIf="errors.midtableSaveError != null">
                    <span style="color: #ac4040;">{{errors.midtableSaveError}}</span>
                </mat-panel-description>
                <mat-panel-description *ngIf="success.midtableSaveSuccess != null">
                    <span style="color: #40ac60;">{{success.midtableSaveSuccess}}</span>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <div *ngIf="(errors.midtableError == null || errors.midtableError == '') && !componentLoading.midtable"
                style="margin-top: 20px;">
                <form [formGroup]="addDbConfigForm" (ngSubmit)="addDatabaseConfig()" autocomplete="off">
                    <div class="row" style="margin-bottom: 10px;">
                        <label class="col-sm-2" for="midTablesType">MidTables Type: </label>
                        <mat-radio-group style="margin: 10px 0 10px 0; display: contents;" name="midTablesType"
                            class="col-sm-12" formControlName="midTablesType"
                            (change)="addDbConfigForm.controls.dbType.setValue(null)">
                            <mat-radio-button class="col-sm-2" value="WASEEL_MID_TABLES"> Waseel MidTables
                            </mat-radio-button>
                            <mat-radio-button class="col-sm-2" value="NPHIES_MID_TABLES"> NPHIES MidTables
                            </mat-radio-button>
                        </mat-radio-group>
                    </div>
                    <div class="row" style="margin-bottom: 10px;">
                        <label class="col-sm-2" for="dbType">Database Type: </label>
                        <mat-radio-group style="margin: 10px 0 10px 0; display: contents;" name="dbType"
                            class="col-sm-12" formControlName="dbType">
                            <mat-radio-button *ngIf="isWaseelMidTables || isNphiesMidTables" class="col-sm-2"
                                value="ORACLE"> Oracle </mat-radio-button>
                            <mat-radio-button *ngIf="isWaseelMidTables" class="col-sm-2" value="MYSQL"> MySql
                            </mat-radio-button>
                            <mat-radio-button *ngIf="isWaseelMidTables" class="col-sm-2" value="SQLSERVER"> SqlServer
                                2016 onwards
                            </mat-radio-button>
                            <mat-radio-button *ngIf="isWaseelMidTables" class="col-sm-2" value="SQLSERVERLEGACY">
                                SqlServer Legacy
                            </mat-radio-button>
                            <mat-radio-button *ngIf="isWaseelMidTables" class="col-sm-2" value="POSTGRESQL"> PostgreSql
                            </mat-radio-button>
                        </mat-radio-group>
                    </div>
                    <div class="row mt-2">
                        <mat-form-field appearance="outline" class="col-sm-4">
                            <mat-label>HostName</mat-label>
                            <input matInput placeholder="HostName/IP" formControlName="hostName" type="text"
                                (change)="validateForm()" autocomplete="">
                        </mat-form-field>
                        <mat-form-field appearance="outline" class="col-sm-4">
                            <mat-label>Port</mat-label>
                            <input matInput placeholder="Port" type="number" formControlName="port"
                                (change)="validateForm()" autocomplete="">
                            <!-- <mat-error *ngIf="port.hasError('required')">Port is required</mat-error> -->
                        </mat-form-field>
                        <mat-form-field appearance="outline" class="col-sm-4">
                            <mat-label>DatabaseName</mat-label>
                            <input matInput placeholder="DatabaseName/SID" type="text" autocomplete=""
                                formControlName="databaseName" (change)="validateForm()">
                            <!-- <mat-error *ngIf="databaseName.hasError('required')">DatabaseName is required</mat-error> -->
                        </mat-form-field>
                    </div>
                    <div class="row mt-2">
                        <mat-form-field appearance="outline" class="col-sm-6">
                            <mat-label>Username</mat-label>
                            <input matInput placeholder="Database Username" type="text" formControlName="dbUserName"
                                (change)="validateForm()" autocomplete="">
                        </mat-form-field>
                        <mat-form-field appearance="outline" class="col-sm-6">
                            <mat-label>Password</mat-label>
                            <input matInput placeholder="Database Passowrd" type="password" formControlName="dbPassword"
                                (change)="validateForm()" autocomplete="new-password">
                        </mat-form-field>
                    </div>
                </form>
            </div>
            <div *ngIf="errors.midtableError != null && errors.midtableError != '' && !componentLoading.midtable"
                style="width: 100%; padding: 10px 30px; display: flex;">
                <p>{{errors.midtableError}}</p>
            </div>
            <div *ngIf="componentLoading.midtable" style="width: 100%; padding: 10px;">
                <mat-spinner style="margin: 0px auto;"></mat-spinner>
            </div>
        </mat-expansion-panel>

        <mat-expansion-panel expanded="false">
            <mat-expansion-panel-header style="background-color: #fbfbfb;">
                <mat-panel-title style="color: #3060AA;">
                    Payer Selection and Mapping
                </mat-panel-title>
                <mat-panel-description *ngIf="errors.payerMappingSaveError != null">
                    <span style="color: #ac4040;">{{errors.payerMappingSaveError}}</span>
                </mat-panel-description>
                <mat-panel-description *ngIf="success.payerMappingSaveSuccess != null">
                    <span style="color: #40ac60;">{{success.payerMappingSaveSuccess}}</span>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <div *ngIf="(errors.payerMappingError == null || errors.payerMappingError == '') && !componentLoading.payerMapping"
                style="margin-top: 20px;">
                <table style="width: 100%; margin: 10px">
                    <thead>
                        <th style="width: 33%">Payer</th>
                        <th style="text-align: center; width: 33%">Mapped Value</th>
                        <th style="text-align: center; width: 33%">Enable/Disable</th>
                    </thead>
                    <tr *ngFor="let payer of associatedPayers;let i = index" style="width: 100%">
                        <td style="width: 33%">
                            <p style="padding: 5px 0; margin: 0; height: 80px;">{{payer.name}}
                            </p>
                        </td>
                        <td style="text-align: center; width: 33%; height: 80px;">
                            <mat-form-field appearance="outline" *ngIf="newPayerMappingEnable[payer.switchAccountId]">
                                <mat-label>value</mat-label>
                                <input matInput placeholder="mapped value"
                                    [(ngModel)]="newPayerMappingValue[payer.switchAccountId]" required type="text">
                            </mat-form-field>
                        </td>
                        <td style="width: 33%; height: 80px;">
                            <mat-slide-toggle style="z-index: 0; display: block; margin-left: auto; margin-right: auto;
                                        width: 15%" color="primary"
                                [(ngModel)]="newPayerMappingEnable[payer.switchAccountId]"
                                (change)="onPayerMapSetting(payer, $event,i)">
                            </mat-slide-toggle>
                        </td>
                    </tr>
                </table>
            </div>
            <div *ngIf="errors.payerMappingError != null && errors.payerMappingError != '' && !componentLoading.payerMapping"
                style="width: 100%; padding: 10px 30px; display: flex;">
                <p>{{errors.payerMappingError}}</p>
            </div>
            <div *ngIf="componentLoading.payerMapping" style="width: 100%; padding: 10px;">
                <mat-spinner style="margin: 0px auto;"></mat-spinner>
            </div>
        </mat-expansion-panel>

        <mat-expansion-panel expanded="false">
            <mat-expansion-panel-header style="background-color: #fbfbfb;">
                <mat-panel-title style="color: #3060AA;">
                    Provider Code Mapping and Extraction Date Config
                </mat-panel-title>
                <mat-panel-description *ngIf="errors.providerMappingSaveError != null">
                    <span style="color: #ac4040;">{{errors.providerMappingSaveError}}</span>
                </mat-panel-description>
                <mat-panel-description *ngIf="success.providerMappingSaveSuccess != null">
                    <span style="color: #40ac60;">{{success.providerMappingSaveSuccess}}</span>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <div *ngIf="(errors.providerMappingError == null || errors.providerMappingError == '') && !componentLoading.providerMapping"
                style="margin-top: 20px;">
                <table style="width: 100%; margin: 10px">
                    <thead>
                        <th style="width:25%;">Provider</th>
                        <th style="text-align: center; width: 24%;">Provider Code</th>
                        <th style="width:25%;text-align: center">Mapped Value</th>
                        <th style="width:25%;text-align: center">Restrict Extraction Prior to</th>
                    </thead>
                    <tr>
                        <td style="width:25%;">{{selectedProviderName}}</td>
                        <td style="text-align: center; width: 24%;">{{selectedProviderCode}}</td>
                        <td style="text-align: center; width: 25%;">
                            <mat-form-field appearance="outline">
                                <mat-label>value</mat-label>
                                <input matInput [formControl]="providerMappingController" placeholder="mapped value"
                                    type="text">
                            </mat-form-field>
                        </td>
                        <td style="text-align: center; width: 25%;">
                            <div class="form-group mb-0">
                                <div class="date-picker">
                                    <input id="restrictExtractionDate" [matDatepicker]="restrictExtractionDatePicker"
                                        placeholder="Select Date" class="form-control"
                                        [formControl]="restrictExtractionDateController">
                                    <mat-datepicker-toggle [for]="restrictExtractionDatePicker"></mat-datepicker-toggle>
                                    <mat-datepicker #restrictExtractionDatePicker></mat-datepicker>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div *ngIf="errors.providerMappingError != null && errors.providerMappingError != '' && !componentLoading.providerMapping"
                style="width: 100%; padding: 10px 30px; display: flex;">
                <p>{{errors.providerMappingError}}</p>
            </div>
            <div *ngIf="componentLoading.providerMapping" style="width: 100%; padding: 10px;">
                <mat-spinner style="margin: 0px auto;"></mat-spinner>
            </div>
        </mat-expansion-panel>

        <mat-expansion-panel expanded="false">
            <mat-expansion-panel-header style="background-color: #fbfbfb;">
                <mat-panel-title style="color: #3060AA;">
                    Price List Validation
                </mat-panel-title>
                <mat-panel-description *ngIf="errors.serviceCodeSaveError != null">
                    <span style="color: #ac4040;">{{errors.serviceCodeSaveError}}</span>
                </mat-panel-description>
                <mat-panel-description *ngIf="success.serviceCodeSaveSuccess != null">
                    <span style="color: #40ac60;">{{success.serviceCodeSaveSuccess}}</span>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <div *ngIf="(errors.payersError == null || errors.payersError == '') && !componentLoading.serviceCode">
                <table style="width: 100%; margin: 10px">
                    <thead>
                        <th>Payer</th>
                        <th style="text-align: center">Service Code Validation</th>
                        <th style="text-align: center">Price Unit</th>
                    </thead>
                    <tr *ngFor="let payer of associatedPayers" style="width: 100%">
                        <td style="widows: 42%">
                            <p [ngStyle]="{'color': (payer.hasAssociatedPriceList)? 'black':'gray'}">{{payer.name}}
                            </p>
                        </td>
                        <td>
                            <mat-slide-toggle style="z-index: 0; display: block; margin-left: auto; margin-right: auto;
                                        width: 15%" [disabled]="!payer.hasAssociatedPriceList" color="primary"
                                [(ngModel)]="newServiceValidationSettings[payer.switchAccountId]">
                            </mat-slide-toggle>
                        </td>
                        <td style="width: 20%;">
                            <mat-checkbox
                                style="z-index: 0; display: block; margin-left: auto; margin-right: auto; width: fit-content"
                                [disabled]="!payer.hasAssociatedPriceList || isPriceUnitDisabled(payer.switchAccountId)"
                                color="primary" [(ngModel)]="newPriceUnitSettings[payer.switchAccountId]">
                                Restrict
                            </mat-checkbox>
                        </td>
                    </tr>
                </table>

            </div>
            <div *ngIf="errors.payersError != null && errors.payersError != '' && !componentLoading.serviceCode"
                style="width: 100%; padding: 10px 30px; display: flex;">
                <p>{{errors.payersError}}</p>
            </div>
            <div *ngIf="componentLoading.serviceCode" style="width: 100%; padding: 10px;">
                <mat-spinner style="margin: 0px auto;"></mat-spinner>
            </div>
        </mat-expansion-panel>


        <mat-expansion-panel expanded="false">
            <mat-expansion-panel-header style="background-color: #fbfbfb;">
                <mat-panel-title style="color: #3060AA;">
                    ICD10 Validation
                </mat-panel-title>
                <mat-panel-description *ngIf="errors.ICD10SaveError != null">
                    <span style="color: #ac4040;">{{errors.ICD10SaveError}}</span>
                </mat-panel-description>
                <mat-panel-description *ngIf="success.ICD10SaveSuccess != null">
                    <span style="color: #40ac60;">{{success.ICD10SaveSuccess}}</span>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <div *ngIf="(errors.payersError == null || errors.payersError == '') && !componentLoading.ICD10Validation">
                <table style="width: 100%; margin: 10px">
                    <thead>
                        <th>Payer</th>
                        <th style="text-align: center">ICD10 Validation</th>
                    </thead>
                    <tr *ngFor="let payer of associatedPayers" style="width: 100%">
                        <td style="widows: 42%">
                            <p>{{payer.name}}
                            </p>
                        </td>
                        <td>
                            <mat-slide-toggle style="z-index: 0; display: block; margin-left: auto; margin-right: auto;
                                        width: 15%" color="primary"
                                [(ngModel)]="newICD10ValidationSettings[payer.switchAccountId]">
                            </mat-slide-toggle>
                        </td>
                    </tr>
                </table>

            </div>
            <div *ngIf="errors.payersError != null && errors.payersError != '' && !componentLoading.ICD10Validation"
                style="width: 100%; padding: 10px 30px; display: flex;">
                <p>{{errors.payersError}}</p>
            </div>
            <div *ngIf="componentLoading.ICD10Validation" style="width: 100%; padding: 10px;">
                <mat-spinner style="margin: 0px auto;"></mat-spinner>
            </div>
        </mat-expansion-panel>


        <mat-expansion-panel expanded="false">
            <mat-expansion-panel-header style="background-color: #fbfbfb;">
                <mat-panel-title style="color: #3060AA;">
                    Portal User Configration
                </mat-panel-title>
                <mat-panel-description *ngIf="errors.portalUserSaveError != null">
                    <span style="color: #ac4040;">{{errors.portalUserSaveError}}</span>
                </mat-panel-description>
                <mat-panel-description *ngIf="success.portalUserSaveSuccess != null">
                    <span style="color: #40ac60;">{{success.portalUserSaveSuccess}}</span>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <div *ngIf="(errors.portalUserError == null || errors.portalUserError == '') && !componentLoading.portalUser"
                style="margin-top: 20px;">
                <mat-form-field appearance="outline" style="width: 49%; margin-right: 2%;">
                    <input matInput placeholder="Portal Username" [formControl]="portalUsernameController" st>
                    <mat-icon matSuffix style="color: #D0CECE;">account_circle</mat-icon>
                </mat-form-field>
                <mat-form-field appearance="outline" style="width: 49%;">
                    <input type="password" matInput placeholder="Passowrd" [formControl]="portalPasswordController">
                    <mat-icon matSuffix style="color: #D0CECE;">lock</mat-icon>
                </mat-form-field>
            </div>
            <div *ngIf="errors.portalUserError != null && errors.portalUserError != '' && !componentLoading.portalUser"
                style="width: 100%; padding: 10px 30px; display: flex;">
                <p>{{errors.portalUserError}}</p>
            </div>
            <div *ngIf="componentLoading.portalUser" style="width: 100%; padding: 10px;">
                <mat-spinner style="margin: 0px auto;"></mat-spinner>
            </div>
        </mat-expansion-panel>

        <mat-expansion-panel expanded="false">
            <mat-expansion-panel-header style="background-color: #fbfbfb;">
                <mat-panel-title style="color: #3060AA;">
                    SFDA Validation
                </mat-panel-title>
                <mat-panel-description *ngIf="errors.sfdaSaveError != null">
                    <span style="color: #ac4040;">{{errors.sfdaSaveError}}</span>
                </mat-panel-description>
                <mat-panel-description *ngIf="success.sfdaSaveSuccess != null">
                    <span style="color: #40ac60;">{{success.sfdaSaveSuccess}}</span>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <div *ngIf="(errors.payersError == null || errors.payersError == '') && !componentLoading.sfda">
                <table style="width: 100%; margin: 10px">
                    <thead>
                        <th>Payer</th>
                        <th style="text-align: center">SFDA Validation</th>
                    </thead>
                    <tr *ngFor="let payer of associatedPayers" style="width: 100%">
                        <td style="widows: 42%">
                            <p [ngStyle]="{'color': (payer.hasAssociatedDrugList)? 'black':'gray'}">{{payer.name}}
                            </p>
                        </td>
                        <td>
                            <mat-slide-toggle style="z-index: 0; display: block; margin-left: auto; margin-right: auto;
                                        width: 15%" color="primary" [disabled]="!payer.hasAssociatedDrugList"
                                [(ngModel)]="newSFDAValidationSettings[payer.switchAccountId]">
                            </mat-slide-toggle>
                        </td>
                    </tr>
                </table>

            </div>
            <div *ngIf="errors.payersError != null && errors.payersError != '' && !componentLoading.sfda"
                style="width: 100%; padding: 10px 30px; display: flex;">
                <p>{{errors.payersError}}</p>
            </div>
            <div *ngIf="componentLoading.sfda" style="width: 100%; padding: 10px;">
                <mat-spinner style="margin: 0px auto;"></mat-spinner>
            </div>
        </mat-expansion-panel>

        <mat-expansion-panel expanded="false">
            <mat-expansion-panel-header style="background-color: #fbfbfb;">
                <mat-panel-title style="color: #3060AA;">
                    PBM Configuration
                </mat-panel-title>
                <mat-panel-description *ngIf="errors.pbmConfigurationSaveError != null">
                    <span style="color: #ac4040;">{{errors.pbmConfigurationSaveError}}</span>
                </mat-panel-description>
                <mat-panel-description *ngIf="success.pbmConfigurationSaveSuccess != null">
                    <span style="color: #40ac60;">{{success.pbmConfigurationSaveSuccess}}</span>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <div
                *ngIf="(errors.pbmConfigurationError == null || errors.pbmConfigurationError == '') && !componentLoading.pbmConfiguration">
                <table style="width: 100%; margin: 10px">
                    <thead>
                        <th>Provider</th>
                        <th style="text-align: center">Enable/Disable</th>
                    </thead>
                    <tr>
                        <td>{{selectedProviderName}}</td>
                        <td class="text-center">
                            <mat-slide-toggle style="z-index: 0; display: block; margin-left: auto; margin-right: auto;
                            width: 15%" color="primary" [(ngModel)]="newPBMValidationSettings['101']">
                            </mat-slide-toggle>
                        </td>
                    </tr>
                </table>
            </div>
            <div *ngIf="componentLoading.pbmConfiguration" style="width: 100%; padding: 10px;">
                <mat-spinner style="margin: 0px auto;"></mat-spinner>
            </div>
        </mat-expansion-panel>

        <mat-expansion-panel expanded="false">
            <mat-expansion-panel-header style="background-color: #fbfbfb;">
                <mat-panel-title style="color: #3060AA;">
                    Net Amount Accuracy</mat-panel-title>
                <mat-panel-description *ngIf="errors.netAmountConfigurationSaveError != null">
                    <span style="color: #ac4040;">{{errors.netAmountConfigurationSaveError}}</span>
                </mat-panel-description>
                <mat-panel-description *ngIf="success.netAmountConfigurationSaveSuccess != null">
                    <span style="color: #40ac60;">{{success.netAmountConfigurationSaveSuccess}}</span>
                </mat-panel-description>
            </mat-expansion-panel-header>
            <div
                *ngIf="(errors.netAmountConfigurationError == null || errors.netAmountConfigurationError == '') && !componentLoading.netAmount">
                <table style="width: 100%; margin: 10px">
                    <thead>
                        <th>Provider</th>
                        <th style="width:33%;text-align: center">Accuracy Amount</th>
                    </thead>
                    <tr>
                        <td>{{selectedProviderName}}</td>
                        <td style="text-align: center; width: 33%;">
                            <mat-form-field appearance="outline">
                                <mat-label>value</mat-label>
                                <input matInput [formControl]="netAmountController" placeholder="0.5 SR" type="number"
                                    pattern="^(\d*\.)?\d+$">
                            </mat-form-field>
                        </td>
                    </tr>
                </table>
            </div>
            <div *ngIf="componentLoading.netAmount" style="width: 100%; padding: 10px;">
                <mat-spinner style="margin: 0px auto;"></mat-spinner>
            </div>
        </mat-expansion-panel>

    </mat-accordion>
</app-detailscard>