<app-detailscard title="Providers Configuration" [bottomLeftActionText]=" (isLoading || componentLoading.serviceCode || componentLoading.portalUser)? '' : 'Reset'"
  [bottomRightActionText]=" (isLoading || componentLoading.serviceCode || componentLoading.portalUser)? '' : 'Save'" (bottomLeftAction)=" reset()" (bottomRightAction)="save()">
  <div class="form-group" [class.mb-0]="selectedProvider == null || selectedProvider == ''">
    <input [matAutocomplete]="auto" [formControl]="providerController" (input)="updateFilter()" [readonly]="isLoading" (keyup.enter)="selectProvider()"
      class="form-control search-box" placeholder="Select provider">
    <mat-autocomplete autoActiveFirstOption #auto>
      <mat-option *ngFor="let provider of filteredProviders" [value]="provider.switchAccountId + ' | ' + provider.code + ' | ' + provider.name"
        (click)="selectProvider(provider.switchAccountId)">
        {{provider.switchAccountId}} | {{provider.code}} | {{provider.name}}
      </mat-option>
      <mat-option *ngIf="errors.providersError != null && errors.providersError != '' && !isLoading">
        {{errors.providersError}}
      </mat-option>
    </mat-autocomplete>
  </div>

  <mat-accordion *ngIf="selectedProvider != null && selectedProvider != ''" hideToggle="true" displayMode="flat" multi="true" class="config-accordion">

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          MidTables Configuration
          <span class="text-danger ml-auto" *ngIf="errors.midtableSaveError != null">{{errors.midtableSaveError}}</span>
          <span class="text-success ml-auto" *ngIf="success.midtableSaveSuccess != null">{{success.midtableSaveSuccess}}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-container *ngIf="(errors.midtableError == null || errors.midtableError == '') && !componentLoading.midtable">
        <form [formGroup]="addDbConfigForm" (ngSubmit)="addDatabaseConfig()" autocomplete="off">
          <mat-checkbox color="primary" [(ngModel)]="isBothSame" [ngModelOptions]="{standalone: true}">Apply same configuration for both Waseel and NPHIES claim extraction
          </mat-checkbox>
          <hr class="hr my-14">
          <div [hidden]="isBothSame" class="form-group">
            <label class="control-label pb-0 text-primary medium">Waseel Configuration</label>
          </div>
          <div class="form-group">
            <label class="control-label pb-0 text-grey">Select Database Type</label>
            <mat-radio-group class="radio-group inline" formControlName="waseelDbType">
              <mat-radio-button color="primary" value="ORACLE">Oracle 11.2 onwards</mat-radio-button>
              <mat-radio-button color="primary" value="ORACLE_11_2">Oracle between 9.0 and 11.1</mat-radio-button>
              <mat-radio-button color="primary" value="POSTGRESQL">PostgreSql</mat-radio-button>
              <mat-radio-button color="primary" value="MYSQL">MySql</mat-radio-button>
              <mat-radio-button color="primary" value="SQLSERVER">SqlServer 2016 onwards</mat-radio-button>
              <mat-radio-button color="primary" value="SQLSERVERLEGACY">SqlServer Legacy</mat-radio-button>
            </mat-radio-group>
          </div>
          <div class="mid-table-config">
            <div class="row small-gutter">
              <div class="col-6">
                <div class="host-wrapper">
                  <div class="form-group host">
                    <label class="control-label">Host Name</label>
                    <input type="text" class="form-control" placeholder="Enter host name" formControlName="waseelHostName" (change)="validateForm()" autocomplete="" />
                  </div>
                  <div class="form-group port">
                    <label class="control-label">Port</label>
                    <input type="number" class="form-control" placeholder="Enter port" formControlName="waseelPort" (change)="validateForm()" autocomplete="" />
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="form-group">
                  <label class="control-label">Database Name</label>
                  <input type="text" class="form-control" placeholder="Enter database name" formControlName="waseelDatabaseName" (change)="validateForm()" autocomplete="" />
                </div>
              </div>
              <div class="col-6">
                <div class="form-group">
                  <label class="control-label">Username</label>
                  <input type="text" class="form-control" placeholder="Enter username" formControlName="waseelDbUserName" (change)="validateForm()" autocomplete="" />
                </div>
              </div>
              <div class="col-6">
                <div class="form-group">
                  <label class="control-label">Password</label>
                  <input type="password" class="form-control" placeholder="Enter password" formControlName="waseelDbPassword" (change)="validateForm()"
                    autocomplete="new-password" />
                </div>
              </div>
            </div>
          </div>
          <div [hidden]="isBothSame">
            <hr class="hr mt-2 mb-14">
            <div class="form-group">
              <label class="control-label pb-0 text-primary medium">NPHIES Configuration</label>
            </div>
            <div class="form-group">
              <label class="control-label pb-0 text-grey">Select Database Type</label>
              <mat-radio-group class="radio-group inline" formControlName="nphiesDbType">
                <mat-radio-button color="primary" value="ORACLE">Oracle 11.2 onwards</mat-radio-button>
                <mat-radio-button color="primary" value="ORACLE_11_2">Oracle between 9.0 and 11.1</mat-radio-button>
                <mat-radio-button color="primary" value="POSTGRESQL">PostgreSql</mat-radio-button>
                <mat-radio-button color="primary" value="MYSQL">MySql</mat-radio-button>
                <mat-radio-button color="primary" value="SQLSERVER">SqlServer 2016 onwards</mat-radio-button>
                <mat-radio-button color="primary" value="SQLSERVERLEGACY">SqlServer Legacy</mat-radio-button>
              </mat-radio-group>
            </div>
            <div class="mid-table-config">
              <div class="row small-gutter">
                <div class="col-6">
                  <div class="host-wrapper">
                    <div class="form-group host">
                      <label class="control-label">Host Name</label>
                      <input type="text" class="form-control" placeholder="Enter host name" formControlName="nphiesHostName" (change)="validateForm()" autocomplete="" />
                    </div>
                    <div class="form-group port">
                      <label class="control-label">Port</label>
                      <input type="number" class="form-control" placeholder="Enter port" formControlName="nphiesPort" (change)="validateForm()" autocomplete="" />
                    </div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label class="control-label">Database Name</label>
                    <input type="text" class="form-control" placeholder="Enter database name" formControlName="nphiesDatabaseName" (change)="validateForm()" autocomplete="" />
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label class="control-label">Username</label>
                    <input type="text" class="form-control" placeholder="Enter username" formControlName="nphiesDbUserName" (change)="validateForm()" autocomplete="" />
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label class="control-label">Password</label>
                    <input type="password" class="form-control" placeholder="Enter password" formControlName="nphiesDbPassword" (change)="validateForm()"
                      autocomplete="new-password" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </ng-container>
      <p *ngIf="errors.midtableError != null && errors.midtableError != '' && !componentLoading.midtable" class="error-card mb-0">{{errors.midtableError}}</p>
      <div class="inline-loader" *ngIf="componentLoading.midtable">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Payer Selection and Mapping
          <span class="text-danger ml-auto" *ngIf="errors.payerMappingSaveError != null">{{errors.payerMappingSaveError}}</span>
          <span class="text-success ml-auto" *ngIf="success.payerMappingSaveSuccess != null">{{success.payerMappingSaveSuccess}}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-container *ngIf="(errors.payerMappingError == null || errors.payerMappingError == '') && !componentLoading.payerMapping">
        <table style="width: 100%; margin: 10px">
          <thead>
            <th style="width: 33%">Payer</th>
            <th style="text-align: center; width: 33%">Mapped Value</th>
            <th style="text-align: center; width: 33%">Enable/Disable</th>
          </thead>
          <tr *ngFor="let payer of associatedPayers;let i = index" style="width: 100%">
            <td style="width: 33%">
              <p style="padding: 5px 0; margin: 0; height: 80px;">{{payer.name}}
              </p>
            </td>
            <td style="text-align: center; width: 33%; height: 80px;">
              <div class="form-group mb-0" *ngIf="newPayerMappingEnable[payer.switchAccountId]">
                <mat-form-field appearance="fill">
                  <mat-label>Value</mat-label>
                  <input matInput placeholder="Mapped value" [(ngModel)]="newPayerMappingValue[payer.switchAccountId]" required type="text">
                </mat-form-field>
              </div>
            </td>
            <td style="width: 33%; height: 80px;">
              <mat-slide-toggle style="z-index: 0; display: block; margin-left: auto; margin-right: auto;
                                        width: 15%" color="primary" [(ngModel)]="newPayerMappingEnable[payer.switchAccountId]" (change)="onPayerMapSetting(payer, $event,i)">
              </mat-slide-toggle>
            </td>
          </tr>
        </table>
      </ng-container>
      <p class="error-card mb-0" *ngIf="errors.payerMappingError != null && errors.payerMappingError != '' && !componentLoading.payerMapping">{{errors.payerMappingError}}</p>
      <div class="inline-loader" *ngIf="componentLoading.payerMapping">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
    </mat-expansion-panel>

    <!-- //Nphies Payer Selection And Mapping For Legacy Midtables -->

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Nphies Payer Selection And Mapping For Legacy Midtables
          <span *ngIf="errors.NphiespayerMappingError != null" class="text-danger ml-auto">{{errors.NphiesMappingSaveError}}</span>
          <span *ngIf="success.NphiesPayerMappingSuccess != null" class="text-success ml-auto">{{success.NphiesPayerMappingSuccess}}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <ng-container *ngIf="(errors.NphiespayerMappingError == null || errors.NphiespayerMappingError == '') && !componentLoading.NphiesPayerMapping">
        <table style="width: 100%; margin: 10px">
          <thead>
            <th style="width: 33%">Payer</th>
            <th style="text-align: center; width: 33%">Mapped Value</th>

          </thead>
          <tr *ngFor="let Nphiepayer of addNphiesPayerMappingList;let i = index" style="width: 100%">
            <td style="width: 33%">
              <p style="padding: 5px 0; margin: 0; height: 80px;">{{newNphiesPayerName[Nphiepayer]}} </p>
            </td>
            <td style="text-align: center; width: 33%; height: 80px;">
              <mat-form-field appearance="outline">
                <mat-label>value</mat-label>
                <input matInput placeholder="mapped value" [(ngModel)]="newNphiesPayerMappingValue[Nphiepayer]" required type="text">
              </mat-form-field>
            </td>

          </tr>
        </table>
      </ng-container>
      <p *ngIf="errors.NphiespayerMappingError != null && errors.NphiespayerMappingError != '' && !componentLoading.NphiesPayerMapping" class="error-card mb-0">
        {{errors.NphiespayerMappingError}}</p>
      <div class="inline-loader" *ngIf="componentLoading.NphiesPayerMapping">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Provider Code Mapping and Extraction Date Config
          <span *ngIf="errors.providerMappingSaveError != null" class="text-danger ml-auto">{{errors.providerMappingSaveError}}</span>
          <span *ngIf="success.providerMappingSaveSuccess != null" class="text-success ml-auto">{{success.providerMappingSaveSuccess}}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-container *ngIf="(errors.providerMappingError == null || errors.providerMappingError == '') && !componentLoading.providerMapping">
        <table style="width: 100%; margin: 10px">
          <thead>
            <th style="width:25%;">Provider</th>
            <th style="text-align: center; width: 24%;">Provider Code</th>
            <th style="width:25%;text-align: center">Mapped Value</th>
            <th style="width:25%;text-align: center">Restrict Extraction Prior to</th>
          </thead>
          <tr>
            <td style="width:25%;">{{selectedProviderName}}</td>
            <td style="text-align: center; width: 24%;">{{selectedProviderCode}}</td>
            <td style="text-align: center; width: 25%;">
              <mat-form-field appearance="outline">
                <mat-label>value</mat-label>
                <input matInput [formControl]="providerMappingController" placeholder="mapped value" type="text">
              </mat-form-field>
            </td>
            <td style="text-align: center; width: 25%;">
              <div class="form-group mb-0">
                <div class="date-picker">
                  <input id="restrictExtractionDate" [matDatepicker]="restrictExtractionDatePicker" placeholder="Select Date" class="form-control"
                    [formControl]="restrictExtractionDateController">
                  <mat-datepicker-toggle [for]="restrictExtractionDatePicker"></mat-datepicker-toggle>
                  <mat-datepicker #restrictExtractionDatePicker></mat-datepicker>
                </div>
              </div>
            </td>
          </tr>
        </table>
      </ng-container>
      <p *ngIf="errors.providerMappingError != null && errors.providerMappingError != '' && !componentLoading.providerMapping" class="error-card mb-0">
        {{errors.providerMappingError}}</p>
      <div *ngIf="componentLoading.providerMapping" class="inline-loader">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Price List Validation
          <span *ngIf="errors.serviceCodeSaveError != null" class="text-danger ml-auto">{{errors.serviceCodeSaveError}}</span>
          <span *ngIf="success.serviceCodeSaveSuccess != null" class="text-success ml-auto">{{success.serviceCodeSaveSuccess}}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-container *ngIf="(errors.payersError == null || errors.payersError == '') && !componentLoading.serviceCode">
        <table style="width: 100%; margin: 10px">
          <thead>
            <th>Payer</th>
            <th style="text-align: center">Service Code Validation</th>
            <th style="text-align: center">Price Unit</th>
          </thead>
          <tr *ngFor="let payer of associatedPayers" style="width: 100%">
            <td style="widows: 42%">
              <p [ngStyle]="{'color': (payer.hasAssociatedPriceList)? 'black':'gray'}">{{payer.name}}
              </p>
            </td>
            <td>
              <mat-slide-toggle style="z-index: 0; display: block; margin-left: auto; margin-right: auto;
                                        width: 15%" [disabled]="!payer.hasAssociatedPriceList" color="primary" [(ngModel)]="newServiceValidationSettings[payer.switchAccountId]">
              </mat-slide-toggle>
            </td>
            <td style="width: 20%;">
              <mat-checkbox style="z-index: 0; display: block; margin-left: auto; margin-right: auto; width: fit-content"
                [disabled]="!payer.hasAssociatedPriceList || isPriceUnitDisabled(payer.switchAccountId)" color="primary" [(ngModel)]="newPriceUnitSettings[payer.switchAccountId]">
                Restrict
              </mat-checkbox>
            </td>
          </tr>
        </table>

      </ng-container>
      <p *ngIf="errors.payersError != null && errors.payersError != '' && !componentLoading.serviceCode" class="error-card mb-0">{{errors.payersError}}</p>
      <div *ngIf="componentLoading.serviceCode" class="inline-loader">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
    </mat-expansion-panel>


    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          ICD10 Validation
          <span *ngIf="errors.ICD10SaveError != null" class="text-danger ml-auto">{{errors.ICD10SaveError}}</span>
          <span *ngIf="success.ICD10SaveSuccess != null" class="text-success ml-auto">{{success.ICD10SaveSuccess}}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-container *ngIf="(errors.payersError == null || errors.payersError == '') && !componentLoading.ICD10Validation">
        <table style="width: 100%; margin: 10px">
          <thead>
            <th>Payer</th>
            <th style="text-align: center">ICD10 Validation</th>
          </thead>
          <tr *ngFor="let payer of associatedPayers" style="width: 100%">
            <td style="widows: 42%">
              <p>{{payer.name}}
              </p>
            </td>
            <td>
              <mat-slide-toggle style="z-index: 0; display: block; margin-left: auto; margin-right: auto;
                                        width: 15%" color="primary" [(ngModel)]="newICD10ValidationSettings[payer.switchAccountId]">
              </mat-slide-toggle>
            </td>
          </tr>
        </table>

      </ng-container>
      <p *ngIf="errors.payersError != null && errors.payersError != '' && !componentLoading.ICD10Validation" class="error-card mb-0">{{errors.payersError}}</p>
      <div *ngIf="componentLoading.ICD10Validation" class="inline-loader">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
    </mat-expansion-panel>


    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Portal User Configration
          <span *ngIf="errors.portalUserSaveError != null" class="text-danger ml-auto">{{errors.portalUserSaveError}}</span>
          <span *ngIf="success.portalUserSaveSuccess != null" class="text-success ml-auto">{{success.portalUserSaveSuccess}}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-container *ngIf="(errors.portalUserError == null || errors.portalUserError == '') && !componentLoading.portalUser">
        <mat-form-field appearance="outline" style="width: 49%; margin-right: 2%;">
          <input matInput placeholder="Portal Username" [formControl]="portalUsernameController" st>
          <mat-icon matSuffix style="color: #D0CECE;">account_circle</mat-icon>
        </mat-form-field>
        <mat-form-field appearance="outline" style="width: 49%;">
          <input type="password" matInput placeholder="Passowrd" [formControl]="portalPasswordController">
          <mat-icon matSuffix style="color: #D0CECE;">lock</mat-icon>
        </mat-form-field>
      </ng-container>
      <p *ngIf="errors.portalUserError != null && errors.portalUserError != '' && !componentLoading.portalUser" class="error-card mb-0">{{errors.portalUserError}}</p>
      <div *ngIf="componentLoading.portalUser" class="inline-loader">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          SFDA Validation
          <span *ngIf="errors.sfdaSaveError != null" class="text-danger ml-auto">{{errors.sfdaSaveError}}</span>
          <span *ngIf="success.sfdaSaveSuccess != null" class="text-success ml-auto">{{success.sfdaSaveSuccess}}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-container *ngIf="(errors.payersError == null || errors.payersError == '') && !componentLoading.sfda">
        <table style="width: 100%; margin: 10px">
          <thead>
            <th>Payer</th>
            <th style="text-align: center">SFDA Validation</th>
          </thead>
          <tr *ngFor="let payer of associatedPayers" style="width: 100%">
            <td style="widows: 42%">
              <p [ngStyle]="{'color': (payer.hasAssociatedDrugList)? 'black':'gray'}">{{payer.name}}
              </p>
            </td>
            <td>
              <mat-slide-toggle style="z-index: 0; display: block; margin-left: auto; margin-right: auto;
                                        width: 15%" color="primary" [disabled]="!payer.hasAssociatedDrugList" [(ngModel)]="newSFDAValidationSettings[payer.switchAccountId]">
              </mat-slide-toggle>
            </td>
          </tr>
        </table>

      </ng-container>
      <p *ngIf="errors.payersError != null && errors.payersError != '' && !componentLoading.sfda" class="error-card mb-0">{{errors.payersError}}</p>
      <div *ngIf="componentLoading.sfda" class="inline-loader">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          PBM Configuration
          <span *ngIf="errors.pbmConfigurationSaveError != null" class="text-danger ml-auto">{{errors.pbmConfigurationSaveError}}</span>
          <span *ngIf="success.pbmConfigurationSaveSuccess != null" class="text-success ml-auto">{{success.pbmConfigurationSaveSuccess}}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-container *ngIf="(errors.pbmConfigurationError == null || errors.pbmConfigurationError == '') && !componentLoading.pbmConfiguration">
        <table style="width: 100%; margin: 10px">
          <thead>
            <th>Provider</th>
            <th style="text-align: center">Enable/Disable</th>
          </thead>
          <tr>
            <td>{{selectedProviderName}}</td>
            <td class="text-center">
              <mat-slide-toggle style="z-index: 0; display: block; margin-left: auto; margin-right: auto;
                            width: 15%" color="primary" [(ngModel)]="newPBMValidationSettings['101']">
              </mat-slide-toggle>
            </td>
          </tr>
        </table>
      </ng-container>
      <div *ngIf="componentLoading.pbmConfiguration" class="inline-loader">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Net Amount Accuracy
          <span *ngIf="errors.netAmountConfigurationSaveError != null" class="text-danger ml-auto">{{errors.netAmountConfigurationSaveError}}</span>
          <span *ngIf="success.netAmountConfigurationSaveSuccess != null" class="text-success ml-auto">{{success.netAmountConfigurationSaveSuccess}}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-container *ngIf="(errors.netAmountConfigurationError == null || errors.netAmountConfigurationError == '') && !componentLoading.netAmount">
        <table style="width: 100%; margin: 10px">
          <thead>
            <th>Provider</th>
            <th style="width:33%;text-align: center">Accuracy Amount</th>
          </thead>
          <tr>
            <td>{{selectedProviderName}}</td>
            <td style="text-align: center; width: 33%;">
              <mat-form-field appearance="outline">
                <mat-label>value</mat-label>
                <input matInput [formControl]="netAmountController" placeholder="0.5 SR" type="number" pattern="^(\d*\.)?\d+$">
              </mat-form-field>
            </td>
          </tr>
        </table>
      </ng-container>
      <div *ngIf="componentLoading.netAmount" class="inline-loader">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
    </mat-expansion-panel>

  </mat-accordion>
</app-detailscard>